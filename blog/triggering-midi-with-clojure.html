<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv='X-UA-Compatible' content='IE=edge;chrome=1' />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Controlling Electronic Instruments With MIDI and Clojure</title>
    <link rel="alternate" type="application/atom+xml" title="Atom Feed" href="/feed.xml" />
    <link href="/blog/stylesheets/main-4b9ba2a1.css" rel="stylesheet" type="text/css" />
    <meta name="description" content="Writing code that makes art and vice versa." />
<meta name="keywords" content="ruby, javascript, code, poetry, clojure, npm, algorithm, art" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:description" content="Writing code that makes art and vice versa." />
<meta property="og:description" content="Writing code that makes art and vice versa." />
  </head>
  <body>
    <center class="THEMAIN">
<a href="/blog">        <img class="header" src="/blog/images/cool-7b689408.png" />
</a>    </center>

    <div id="main" role="main">
        <article>
    <h1>Controlling Electronic Instruments With MIDI and Clojure</h1>

<h2>Let Rich Hickey Be Your DJ</h2>

<p>Most of the time when people are trying to use MIDI in Overtone and Clojure, they just want to play an artisanal hand-coded soft-synth with a standard MIDI keyboard. And there are plenty of helper methods and <a href="https://github.com/overtone/overtone/wiki/midi">some documentation</a> to make this easy, but what if you want to use Clojure as a MIDI sequencer for hardware samplers and synthesizers? The same functional-programming and LISP-y principles that make Clojure effective for audio synthesis can be just as powerful when used for audio sequencing. </p>

<p>Recently I have been working on a <a href="https://github.com/coleww/overtone-live-coding/blob/master/src/my_symphony/sequencer.clj">probability-based audio sequencer</a>, which allows you to write music as deeply nested arrays of numbers that are then &ldquo;performed&rdquo; by the computer, resulting in different compositions each time. It is absolutely thrilling to create music by typing integers into emacs, I swear.</p>

<p>I could of course just have this sequencer control some of the synths that are built into Overtone, but I feel much more comfortable manipulating sounds on actual drum machines and FX pedals. Overtone has very little documentation in regards to sending MIDI signals out to control other devices, but luckily the <a href="https://github.com/overtone/overtone/blob/master/src/overtone/studio/midi.clj">source code</a> to the high-level Overtone MIDI module is clearly written and of a reasonable length. <em>Though of course had this blog post existed yesterday I would have just read this and not bothered reading the code at all&hellip; ah, c&#39;est la open source.</em></p>

<h3>LETS ROLL</h3>

<p>This is what we are trying to achieve: write some sweet sequencing code that sends MIDI data to our hardware instruments, that way we can live code changes to the sequencer and manipulate FX on the instruments directly.</p>

<blockquote class="instagram-media" data-instgrm-captioned data-instgrm-version="4" style=" background:#FFF; border:0; border-radius:3px; box-shadow:0 0 1px 0 rgba(0,0,0,0.5),0 1px 10px 0 rgba(0,0,0,0.15); margin: 1px; max-width:658px; padding:0; width:99.375%; width:-webkit-calc(100% - 2px); width:calc(100% - 2px);"><div style="padding:8px;"> <div style=" background:#F8F8F8; line-height:0; margin-top:40px; padding:50.0% 0; text-align:center; width:100%;"> <div style=" background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACwAAAAsCAMAAAApWqozAAAAGFBMVEUiIiI9PT0eHh4gIB4hIBkcHBwcHBwcHBydr+JQAAAACHRSTlMABA4YHyQsM5jtaMwAAADfSURBVDjL7ZVBEgMhCAQBAf//42xcNbpAqakcM0ftUmFAAIBE81IqBJdS3lS6zs3bIpB9WED3YYXFPmHRfT8sgyrCP1x8uEUxLMzNWElFOYCV6mHWWwMzdPEKHlhLw7NWJqkHc4uIZphavDzA2JPzUDsBZziNae2S6owH8xPmX8G7zzgKEOPUoYHvGz1TBCxMkd3kwNVbU0gKHkx+iZILf77IofhrY1nYFnB/lQPb79drWOyJVa/DAvg9B/rLB4cC+Nqgdz/TvBbBnr6GBReqn/nRmDgaQEej7WhonozjF+Y2I/fZou/qAAAAAElFTkSuQmCC); display:block; height:44px; margin:0 auto -44px; position:relative; top:-22px; width:44px;"></div></div> <p style=" margin:8px 0 0 0; padding:0 4px;"> <a href="https://instagram.com/p/6_KhLZSaV_/" style=" color:#000; font-family:Arial,sans-serif; font-size:14px; font-style:normal; font-weight:normal; line-height:17px; text-decoration:none; word-wrap:break-word;" target="_top">Controlling drum machine and keyboard with Clojure over MIDI.</a></p> <p style=" color:#c9c8cd; font-family:Arial,sans-serif; font-size:14px; line-height:17px; margin-bottom:0; margin-top:8px; overflow:hidden; padding:8px 0 7px; text-align:center; text-overflow:ellipsis; white-space:nowrap;">A video posted by coles 2 metal (@cole_dubs) on <time style=" font-family:Arial,sans-serif; font-size:14px; line-height:17px;" datetime="2015-08-30T00:11:57+00:00">Aug 29, 2015 at 5:11pm PDT</time></p></div></blockquote>

<script async defer src="//platform.instagram.com/en_US/embeds.js"></script>

<p>First things first: open up a new .clj file and add a namespace declaration:</p>
<pre class="highlight plaintext"><code>  (ns midi-seq.core
    (:require [overtone.live :refer :all]
              [overtone.studio.midi :refer :all]))
</code></pre>

<p>This will pull in overtone and the midi functions we need. Next connect your computer to your hardware audio device with some sort of a USB-to-MIDI cable. Make sure you do this before launching Overtone, as it will only register MIDI devices that are found on boot up.</p>

<p>Next, use <code>cider-jack-in</code> to connect to a REPL. I use <a href="https://github.com/overtone/emacs-live">emacs live</a> for all my Clojure hacking, and it integrates very well with Overtone. Evaluate the namespace to load all the requires, and then if you run <code>(midi-connected-receivers)</code> you should see your MIDI output device listed. If this function returns nothing then something went horribly wrong and I cannot help you, sorry! </p>

<p>The way you send out a midi-note is to use the function called, um, <code>midi-note</code>, and it takes the following arguments: <code>receiver midi-note velocity(0-127) duration(s) channel</code>, with channel being optional. You might notice that <code>(first (midi-connected-receivers))</code> contains a key called <code>:receiver</code> that points to some kind of MIDI output object and so you might also guess that the <code>midi-note</code> function is expecting that as it&rsquo;s receiver argument, and you would be incorrect, much like I was. It just wants that whole entire receiver object for some reason. That&rsquo;s cool. </p>

<p>If we are hooked up to a synthesizer, we can play a C4 note (a.k.a. MIDI note 60) at full velocity for 1 second like so:</p>
<pre class="highlight clojure"><code><span class="p">(</span><span class="nf">midi-note</span><span class="w"> </span><span class="p">(</span><span class="nb">first</span><span class="w"> </span><span class="p">(</span><span class="nf">midi-connected-receivers</span><span class="p">))</span><span class="w"> </span><span class="mi">60</span><span class="w"> </span><span class="mi">127</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w">
</span></code></pre>

<p>Hopefully you only have the one MIDI receiver connected, but if there are multiple outputs listed then you will have to figure out which one is correct through trial and error or a lucky guess. I assume that if you have multiple MIDI outputs you know what you are doing here. Cheers. </p>

<h4>A pro-tip for creative technologists:</h4>

<p>Programmers like to zero-index EVERYTHING because that is the computer science way of doing things. However, consumer audio equipment tends to number things 1-10. For example, my Boss SP-303 sampler says that it will respond to events on channel 10, but for Overtone that is actually channel 9 i.e, <code>(midi-note (first (midi-connected-receivers)) 96 127 1 9)</code>. If you are ever trying to hook things together through some sort of integer/index/channel and nothing is working, consider the possibility that the two sides hold differing opinions on how to count to ten. </p>

<h4>WHAT ELSE CAN MY COMPUTER CONTROL?</h4>

<p>MIDI can initiate program changes, modulate effects, start, stop, and change sequences, and much more. But you will probably need to read a lot of MIDI implementation specs and the Overtone MIDI source code in order to figure out what data to send to do those things. I was trying to do something as simple as changing the selected pad bank on my Boss SP-505 and gave up after scouring the <a href="http://sp-forums.com/viewtopic.php?f=7&amp;t=10941&amp;start=0">many</a>, <a href="http://forums.rolandclan.com/viewtopic.php?f=16&amp;t=34352">many</a>, <a href="http://www.vsplanet.com/ubbthreads/ubbthreads.php?ubb=showflat&amp;Number=210137">many</a>, <a href="https://www.gearslutz.com/board/electronic-music-instruments-electronic-music-production/783954-boss-sp-505-question.html">many</a>, <a href="http://www.vdrums.com/forum/advanced/technical/11801-triggering-samples-with-a-boss-sp-505-sampler">many</a> unanswered threads about this subject.</p>

  </article>
  <br />
  <hr />
  <br />
  <br />
  <br />
  <br />
  <br />
  <br />
  <br />
  <br />
  <br />
  <br />
  <br />
  <br />
  See something wrong?<br />
  or just want to say hello?<br />
  <a href="https://github.com/coleww/cole-codes-cool-code/tree/master/source">this blogotronz</a> is open-source!<br />
  file an issue or make a pull-request or whatever i'm not about to tell you what to do there is no authority but yourself.<br />

      <br/>
      <br/>
      <br/>
      <br/>
      <br/>
      <br/>
      <br/>
      <br/>
      <br/>
      <br/>
      <br/>
      <br/>
    </div>

    <aside>
      <p><div id="contact">
        <a href="http://colewillsea.com/">Cole Willsea</a>
        (<a href="https://github.com/coleww">github</a>)
        (<a href="https://twitter.com/colewillsea">twitter</a>)
      </div></p>
      <h2>RECENT BLAGZ</h2>
      <ol>
          <li><a href="/blog/what-i-made-after-xoxo.html">what-i-made-after-xoxo</a> <span>Oct 13</span></li>
          <li><a href="/blog/npm-install-regex.html">npm install regex</a> <span>Oct  4</span></li>
          <li><a href="/blog/drawing-art-to-the-canvas-in-node.html">Drawing Art To The Canvas With Node</a> <span>Sep 25</span></li>
          <li><a href="/blog/after-a-lot-of-thought-i-have-decided-to-shutdown-my-bong.html">After A Lot Of Thought, I Have Decided To Shut Down My VC Backed Bong</a> <span>Sep 23</span></li>
          <li><a href="/blog/making-an-twitter-image-bot.html">Making an Image Bot on Twitter</a> <span>Sep 22</span></li>
      </ol>

      <h2>CALENDAR</h2>
      <ol>
        <h4><li><a href="/blog/blog/2015.html">2015: 22 BLAGS</a></h4>
          <ol>
              <h5><li><a href="/blog/blog/2015/10.html">October 2015: 2 bloogss</a></li></h5>
              <h5><li><a href="/blog/blog/2015/09.html">September 2015: 5 blags</a></li></h5>
              <h5><li><a href="/blog/blog/2015/08.html">August 2015: 7 bloogss</a></li></h5>
              <h5><li><a href="/blog/blog/2015/07.html">July 2015: 4 blogs</a></li></h5>
              <h5><li><a href="/blog/blog/2015/06.html">June 2015: 3 bloogss</a></li></h5>
              <h5><li><a href="/blog/blog/2015/05.html">May 2015: 1 bags</a></li></h5>
          </ol>
        </li>
        <h4><li><a href="/blog/blog/2014.html">2014: 6 BLAGS</a></h4>
          <ol>
              <h5><li><a href="/blog/blog/2014/10.html">October 2014: 1 blags</a></li></h5>
              <h5><li><a href="/blog/blog/2014/09.html">September 2014: 2 bags</a></li></h5>
              <h5><li><a href="/blog/blog/2014/08.html">August 2014: 3 blogotronz</a></li></h5>
          </ol>
        </li>
      </ol>

      <h2>TAGZ</h2>
      <ol>
          <li><a href="/blog/blog/tags/node.html">node (10)</a></li>
          <li><a href="/blog/blog/tags/unix.html">unix (9)</a></li>
          <li><a href="/blog/blog/tags/ruby.html">ruby (7)</a></li>
          <li><a href="/blog/blog/tags/javascript.html">javascript (5)</a></li>
          <li><a href="/blog/blog/tags/npm.html">npm (4)</a></li>
          <li><a href="/blog/blog/tags/clojure.html">clojure (3)</a></li>
          <li><a href="/blog/blog/tags/emacs.html">emacs (3)</a></li>
          <li><a href="/blog/blog/tags/command-line.html">command line (2)</a></li>
          <li><a href="/blog/blog/tags/noise.html">noise (2)</a></li>
          <li><a href="/blog/blog/tags/overtone.html">overtone (2)</a></li>
          <li><a href="/blog/blog/tags/bash.html">bash (2)</a></li>
          <li><a href="/blog/blog/tags/music.html">music (2)</a></li>
          <li><a href="/blog/blog/tags/tdd.html">tdd (2)</a></li>
          <li><a href="/blog/blog/tags/ember.html">ember (2)</a></li>
          <li><a href="/blog/blog/tags/bots.html">bots (2)</a></li>
          <li><a href="/blog/blog/tags/generators.html">generators (2)</a></li>
          <li><a href="/blog/blog/tags/rails.html">rails (2)</a></li>
          <li><a href="/blog/blog/tags/art.html">art (2)</a></li>
          <li><a href="/blog/blog/tags/situationism.html">situationism (2)</a></li>
          <li><a href="/blog/blog/tags/error-handling.html">error handling (1)</a></li>
          <li><a href="/blog/blog/tags/the-occupy-movement.html">the occupy movement (1)</a></li>
          <li><a href="/blog/blog/tags/burn-out.html">burn out (1)</a></li>
          <li><a href="/blog/blog/tags/tech-culture.html">tech culture (1)</a></li>
          <li><a href="/blog/blog/tags/magneto.html">magneto (1)</a></li>
          <li><a href="/blog/blog/tags/gems.html">gems (1)</a></li>
          <li><a href="/blog/blog/tags/jquery.html">jquery (1)</a></li>
          <li><a href="/blog/blog/tags/conceptual-art.html">conceptual art (1)</a></li>
          <li><a href="/blog/blog/tags/twitter.html">twitter (1)</a></li>
          <li><a href="/blog/blog/tags/async.html">async (1)</a></li>
          <li><a href="/blog/blog/tags/blink182.html">blink182 (1)</a></li>
          <li><a href="/blog/blog/tags/middleman.html">middleman (1)</a></li>
          <li><a href="/blog/blog/tags/syntax-highlighting.html">syntax highlighting (1)</a></li>
          <li><a href="/blog/blog/tags/code.html">code (1)</a></li>
          <li><a href="/blog/blog/tags/meta-blog.html">meta-blog (1)</a></li>
          <li><a href="/blog/blog/tags/markdown.html">markdown (1)</a></li>
          <li><a href="/blog/blog/tags/john-gruber.html">john gruber (1)</a></li>
          <li><a href="/blog/blog/tags/paste-events.html">paste events (1)</a></li>
          <li><a href="/blog/blog/tags/browser-hijacking.html">browser hijacking (1)</a></li>
          <li><a href="/blog/blog/tags/magic.html">magic (1)</a></li>
          <li><a href="/blog/blog/tags/glue.html">glue (1)</a></li>
          <li><a href="/blog/blog/tags/asm.html">asm (1)</a></li>
          <li><a href="/blog/blog/tags/loading-routes.html">loading routes (1)</a></li>
          <li><a href="/blog/blog/tags/spinner-gif.html">spinner gif (1)</a></li>
          <li><a href="/blog/blog/tags/tom-dale.html">tom dale (1)</a></li>
          <li><a href="/blog/blog/tags/cron-job.html">cron job (1)</a></li>
          <li><a href="/blog/blog/tags/digital-ocean.html">digital ocean (1)</a></li>
          <li><a href="/blog/blog/tags/twitter-bots.html">twitter bots (1)</a></li>
          <li><a href="/blog/blog/tags/path.html">path (1)</a></li>
          <li><a href="/blog/blog/tags/ubuntu.html">ubuntu (1)</a></li>
          <li><a href="/blog/blog/tags/shell-scripts.html">shell scripts (1)</a></li>
          <li><a href="/blog/blog/tags/pasta-recipes.html">pasta recipes (1)</a></li>
          <li><a href="/blog/blog/tags/exec.html">exec (1)</a></li>
          <li><a href="/blog/blog/tags/kexec.html">kexec (1)</a></li>
          <li><a href="/blog/blog/tags/open-sauce.html">open sauce (1)</a></li>
          <li><a href="/blog/blog/tags/c.html">c (1)</a></li>
          <li><a href="/blog/blog/tags/linkedin.html">linkedin (1)</a></li>
          <li><a href="/blog/blog/tags/cli-tool.html">cli tool (1)</a></li>
          <li><a href="/blog/blog/tags/pipe.html">pipe (1)</a></li>
          <li><a href="/blog/blog/tags/yargs.html">yargs (1)</a></li>
          <li><a href="/blog/blog/tags/cors.html">cors (1)</a></li>
          <li><a href="/blog/blog/tags/api.html">api (1)</a></li>
          <li><a href="/blog/blog/tags/http.html">http (1)</a></li>
          <li><a href="/blog/blog/tags/the-rocky-mountain-brew.html">the rocky mountain brew (1)</a></li>
          <li><a href="/blog/blog/tags/vim.html">vim (1)</a></li>
          <li><a href="/blog/blog/tags/text-editors.html">text editors (1)</a></li>
          <li><a href="/blog/blog/tags/life-goals.html">life goals (1)</a></li>
          <li><a href="/blog/blog/tags/pitch.html">pitch (1)</a></li>
          <li><a href="/blog/blog/tags/samples.html">samples (1)</a></li>
          <li><a href="/blog/blog/tags/career-advice.html">career advice (1)</a></li>
          <li><a href="/blog/blog/tags/poetry.html">poetry (1)</a></li>
          <li><a href="/blog/blog/tags/literature.html">literature (1)</a></li>
          <li><a href="/blog/blog/tags/testing.html">testing (1)</a></li>
          <li><a href="/blog/blog/tags/close-to-the-metal.html">close to the metal (1)</a></li>
          <li><a href="/blog/blog/tags/meta-tdd.html">meta-tdd (1)</a></li>
          <li><a href="/blog/blog/tags/the-metal.html">the metal (1)</a></li>
          <li><a href="/blog/blog/tags/tmux.html">tmux (1)</a></li>
          <li><a href="/blog/blog/tags/ssh.html">ssh (1)</a></li>
          <li><a href="/blog/blog/tags/multiplexing.html">multiplexing (1)</a></li>
          <li><a href="/blog/blog/tags/the-future.html">the future (1)</a></li>
          <li><a href="/blog/blog/tags/errors.html">errors (1)</a></li>
          <li><a href="/blog/blog/tags/problems.html">problems (1)</a></li>
          <li><a href="/blog/blog/tags/throwing.html">throwing (1)</a></li>
          <li><a href="/blog/blog/tags/catching.html">catching (1)</a></li>
          <li><a href="/blog/blog/tags/human-brain-response-times.html">human brain response times (1)</a></li>
          <li><a href="/blog/blog/tags/magic-square.html">magic square (1)</a></li>
          <li><a href="/blog/blog/tags/midi.html">midi (1)</a></li>
          <li><a href="/blog/blog/tags/boss-sp.html">boss sp (1)</a></li>
          <li><a href="/blog/blog/tags/irc.html">irc (1)</a></li>
          <li><a href="/blog/blog/tags/url.html">url (1)</a></li>
          <li><a href="/blog/blog/tags/bot.html">bot (1)</a></li>
          <li><a href="/blog/blog/tags/logging.html">logging (1)</a></li>
          <li><a href="/blog/blog/tags/delicious.html">delicious (1)</a></li>
          <li><a href="/blog/blog/tags/sound.html">sound (1)</a></li>
          <li><a href="/blog/blog/tags/web-audio.html">web audio (1)</a></li>
          <li><a href="/blog/blog/tags/twitter-bot.html">twitter bot (1)</a></li>
          <li><a href="/blog/blog/tags/image-bot.html">image bot (1)</a></li>
          <li><a href="/blog/blog/tags/weed.html">weed (1)</a></li>
          <li><a href="/blog/blog/tags/bong.html">bong (1)</a></li>
          <li><a href="/blog/blog/tags/satire.html">satire (1)</a></li>
          <li><a href="/blog/blog/tags/venture-capital.html">venture capital (1)</a></li>
          <li><a href="/blog/blog/tags/my-bong.html">my bong (1)</a></li>
          <li><a href="/blog/blog/tags/canvas.html">canvas (1)</a></li>
          <li><a href="/blog/blog/tags/detournement.html">detournement (1)</a></li>
          <li><a href="/blog/blog/tags/regex.html">regex (1)</a></li>
          <li><a href="/blog/blog/tags/laziness.html">laziness (1)</a></li>
      </ol>
    </aside>
    <script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(["_setAccount", "UA-26036675-1"]);
  _gaq.push(["_trackPageview"]);
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? '//ssl' : '//www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
  </body>
</html>
