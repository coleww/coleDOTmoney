<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv='X-UA-Compatible' content='IE=edge;chrome=1' />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>overtone-pitching-samples</title>
    <link rel="alternate" type="application/atom+xml" title="Atom Feed" href="/feed.xml" />
    <link href="/blog/stylesheets/main.css" rel="stylesheet" type="text/css" />
    <meta name="description" content="Making art with code and vice versa." />
<meta name="keywords" content="ruby, javascript, code, art" />
  </head>
  <body>
    <center>
<a href="/blog">        <img class="header" src="/blog/images/cool.png" />
</a>    </center>

    <div id="main" role="main">
      <p>For a while now I have been <a href="http://shreddit-hard-co.re/">building interfaces</a> for <a href="http://coleww.github.io/problumz/">creating music</a> with <a href="https://www.npmjs.com/package/drone-e-o-synth">JavaScript and Web Audio</a>, but apparently Overtone already does everything I could ever possibly think of or want. Cool, my lifes work for nothing.</p>

<p>One of the coolest things about Overtone is that it interfaces directly with <a href="https://www.freesound.org/">Freesound</a>, a database of free audio samples. That means that you can execute <code>(freesound 123456)</code> and the audio file at ID 123456 will be automatically downloaded, stored in <code>.overtone/assets</code>, and played back. I don&rsquo;t know what sample 123456 is, so listener beware&hellip; </p>

<p>With this newly discovered power I began scouring the Freesound website for vocal samples to lay on top of my music. I found this sample pack called <a href="https://www.freesound.org/people/beskhu/packs/4560/">Simplesong (MAC) pitched vocal formants</a> and set out to convert it into an instrument along the lines of this <a href="http://blog.josephwilk.net/clojure/creating-instruments-with-overtone.html">blog post by Joseph Wilk</a></p>

<p>Now that I had samples that I liked I just needed to grab their IDs from the website. The aformentioned Joseph Wilk post contains a Ruby script for grabbing ids for a pack, and I also wrote a <a href="https://gist.github.com/coleww/939bc606645c57dd1b29">node script</a> for grabbing IDs based on a query. </p>

<p>Unfortunately, this pack only contained samples of the notes C# A# G and E at various octaves, but I could still play the intermediate pitches by altering the playback rate of the sample. If I wanted to play midi note 34 but I only had a sample for midi note 32 I would just convert both notes to frequencies, divide them, and use the result as the playback value: <code>((freesound 123456) :rate (/ (midi-&gt;hz 34) (midi-&gt;hz 32)))</code>. </p>

<p>With this simple piece of mathematics in hand, I just needed a play function to do all the equations and make some noise:</p>
<pre class="highlight clojure"><code><span class="p">(</span><span class="nf">ns</span><span class="w"> </span><span class="n">syllable-synth.synth</span><span class="w">
  </span><span class="p">(</span><span class="no">:require</span><span class="w"> </span><span class="p">[</span><span class="n">overtone.live</span><span class="w"> </span><span class="no">:refer</span><span class="w"> </span><span class="no">:all</span><span class="p">]))</span><span class="w">

</span><span class="c1">;; object of objects mapping syllable sound to midi note to a freesound sample
</span><span class="p">(</span><span class="k">def</span><span class="w"> </span><span class="n">voices</span><span class="w"> </span><span class="p">{</span><span class="w">

  </span><span class="c1">;; there were many different syllable sounds represented, but for this example we can only make "oooo" sounds
</span><span class="w">  </span><span class="no">:oooo</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="mi">70</span><span class="w"> </span><span class="p">(</span><span class="nf">freesound</span><span class="w"> </span><span class="mi">70529</span><span class="p">)</span><span class="w"> </span><span class="mi">67</span><span class="w"> </span><span class="p">(</span><span class="nf">freesound</span><span class="w"> </span><span class="mi">70528</span><span class="p">)</span><span class="w"> </span><span class="mi">64</span><span class="w"> </span><span class="p">(</span><span class="nf">freesound</span><span class="w"> </span><span class="mi">70527</span><span class="p">)</span><span class="w"> </span><span class="mi">61</span><span class="w"> </span><span class="p">(</span><span class="nf">freesound</span><span class="w"> </span><span class="mi">70526</span><span class="p">)</span><span class="w"> </span><span class="mi">58</span><span class="w"> </span><span class="p">(</span><span class="nf">freesound</span><span class="w"> </span><span class="mi">70525</span><span class="p">)</span><span class="w"> </span><span class="mi">55</span><span class="w"> </span><span class="p">(</span><span class="nf">freesound</span><span class="w"> </span><span class="mi">70524</span><span class="p">)</span><span class="w"> </span><span class="mi">52</span><span class="w"> </span><span class="p">(</span><span class="nf">freesound</span><span class="w"> </span><span class="mi">70523</span><span class="p">)</span><span class="w"> </span><span class="mi">49</span><span class="w"> </span><span class="p">(</span><span class="nf">freesound</span><span class="w"> </span><span class="mi">70522</span><span class="p">)</span><span class="w"> </span><span class="mi">46</span><span class="w"> </span><span class="p">(</span><span class="nf">freesound</span><span class="w"> </span><span class="mi">70521</span><span class="p">)</span><span class="w"> </span><span class="mi">43</span><span class="w"> </span><span class="p">(</span><span class="nf">freesound</span><span class="w"> </span><span class="mi">70520</span><span class="p">)</span><span class="w"> </span><span class="mi">40</span><span class="w"> </span><span class="p">(</span><span class="nf">freesound</span><span class="w"> </span><span class="mi">70519</span><span class="p">)</span><span class="w"> </span><span class="mi">37</span><span class="w"> </span><span class="p">(</span><span class="nf">freesound</span><span class="w"> </span><span class="mi">70518</span><span class="p">)</span><span class="w"> </span><span class="mi">34</span><span class="w"> </span><span class="p">(</span><span class="nf">freesound</span><span class="w"> </span><span class="mi">70517</span><span class="p">)</span><span class="w"> </span><span class="mi">31</span><span class="w"> </span><span class="p">(</span><span class="nf">freesound</span><span class="w"> </span><span class="mi">70516</span><span class="p">)}})</span><span class="w">

</span><span class="p">(</span><span class="k">defn</span><span class="w"> </span><span class="n">play</span><span class="w">
  </span><span class="s">"accepts midi note and syllable to play, uses random if none passed"</span><span class="w">
  </span><span class="p">[</span><span class="n">note</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="p">[</span><span class="n">syll</span><span class="p">]]</span><span class="w">

        </span><span class="c1">;; if no syllable is passed, pick one at random
</span><span class="w">  </span><span class="p">(</span><span class="k">let</span><span class="w"> </span><span class="p">[</span><span class="n">syllable</span><span class="w"> </span><span class="p">(</span><span class="nb">or</span><span class="w"> </span><span class="n">syll</span><span class="w"> </span><span class="p">(</span><span class="nf">rand-nth</span><span class="w"> </span><span class="p">(</span><span class="nb">keys</span><span class="w"> </span><span class="n">voices</span><span class="p">)))</span><span class="w">

        </span><span class="c1">;; grab the notes for which we have a sample 
</span><span class="w">        </span><span class="c1">;; that are lower than the note we want to play
</span><span class="w">        </span><span class="n">notes</span><span class="w"> </span><span class="p">(</span><span class="nb">filter</span><span class="w"> </span><span class="o">#</span><span class="p">(</span><span class="nb">&lt;=</span><span class="w"> </span><span class="n">%</span><span class="w"> </span><span class="n">note</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nb">keys</span><span class="w"> </span><span class="p">(</span><span class="nf">syllable</span><span class="w"> </span><span class="n">voices</span><span class="p">)))</span><span class="w">

        </span><span class="c1">;; our base-note is the highest note in notes, 
</span><span class="w">        </span><span class="c1">;; or 31 if it is lower than 31
</span><span class="w">        </span><span class="n">base-note</span><span class="w"> </span><span class="p">(</span><span class="nb">or</span><span class="w"> </span><span class="p">(</span><span class="nb">last</span><span class="w"> </span><span class="p">(</span><span class="nb">sort</span><span class="w"> </span><span class="n">notes</span><span class="p">)</span><span class="w"> </span><span class="mi">31</span><span class="p">)</span><span class="w">

        </span><span class="c1">;; in order to pitch the base-note up to our desired note, 
</span><span class="w">        </span><span class="c1">;; we convert them both to frequencies and divide
</span><span class="w">        </span><span class="n">rate</span><span class="w"> </span><span class="p">(</span><span class="nb">/</span><span class="w"> </span><span class="p">(</span><span class="nf">midi-&gt;hz</span><span class="w"> </span><span class="n">note</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nf">midi-&gt;hz</span><span class="w"> </span><span class="n">base-note</span><span class="p">))]</span><span class="w">

    </span><span class="c1">;; grab the sample for the given syllable and base-note,
</span><span class="w">    </span><span class="c1">;; and play it back with the rate set 
</span><span class="w">    </span><span class="c1">;; to pitch the sample up the desired note
</span><span class="w">    </span><span class="p">((</span><span class="nb">get</span><span class="w"> </span><span class="p">(</span><span class="nf">syllable</span><span class="w"> </span><span class="n">voices</span><span class="p">)</span><span class="w"> </span><span class="n">base-note</span><span class="p">)</span><span class="w"> </span><span class="no">:rate</span><span class="w"> </span><span class="n">rate</span><span class="p">)))</span><span class="w">


</span><span class="p">(</span><span class="nf">play</span><span class="w"> </span><span class="mi">40</span><span class="p">)</span><span class="w">

</span></code></pre>

<p>You can see the complete code <a href="https://github.com/coleww/my-symphony/blob/master/src/my_symphony/silly-bills.clj">here</a> or see it <a href="https://github.com/coleww/my-symphony/blob/master/src/my_symphony/beat.clj">in action</a>.</p>

      <br/>
      <br/>
      <br/>
      <br/>
      <br/>
      <br/>
      <br/>
      <br/>
      <br/>
      <br/>
      <br/>
      <br/>
    </div>

    <aside>
      <p><div id="contact">
        <a href="http://colewillsea.com/">Cole Willsea</a>
        (<a href="https://github.com/coleww">github</a>)
        (<a href="https://twitter.com/colewillsea">twitter</a>)
      </div></p>
      <h2>RECENT BLAGZ</h2>
      <ol>
          <li><a href="/blog/overtone-pitching-samples.html">overtone-pitching-samples</a> <span>Jul 26</span></li>
          <li><a href="/blog/node-cors.html">Building a simple CORS API in node</a> <span>Jul 22</span></li>
          <li><a href="/blog/npm-cli.html">Building a *nice* CLI For Your Sick npm Module</a> <span>Jul 16</span></li>
          <li><a href="/blog/shelling-out.html">shelling out to the system</a> <span>Jul 10</span></li>
          <li><a href="/blog/do-cron.html">automating bots with cron on digital ocean</a> <span>Jun 23</span></li>
          <li><a href="/blog/trigger-loading-route-in-ember.html">Manually Trigger Loading Routes in Ember</a> <span>Jun  9</span></li>
          <li><a href="/blog/eating-glue-and-paste.html">Eating Glue</a> <span>Jun  3</span></li>
          <li><a href="/blog/syntax-highlighting-in-middleman.html">100% EZ Syntax Highlighting With Middleman</a> <span>May 30</span></li>
      </ol>

    </aside>
    <script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(["_setAccount", "UA-26036675-1"]);
  _gaq.push(["_trackPageview"]);
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? '//ssl' : '//www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>

  </body>
</html>
