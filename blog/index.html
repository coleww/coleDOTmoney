<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv='X-UA-Compatible' content='IE=edge;chrome=1' />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Cole Codes Cool Code</title>
    <link rel="alternate" type="application/atom+xml" title="Atom Feed" href="/feed.xml" />
    <link href="/blog/stylesheets/main-b8100501.css" rel="stylesheet" type="text/css" />
    <meta name="description" content="Making art with code and vice versa." />
<meta name="keywords" content="ruby, javascript, code, clojure, npm, algorithm, art" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:description" content="Making art with code and vice versa." />
<meta property="og:description" content="Making art with code and vice versa." />
  </head>
  <body>
    <center>
<a href="/blog">        <img class="header" src="/blog/images/cool-7b689408.png" />
</a>    </center>

    <div id="main" role="main">
        <h2><a href="/blog/node-poetry-modules.html">Node.js Poetic Modules</a> <span>Aug  1</span></h2>
  <!-- <h1>Node.js Poetic Modules</h1>

<h2>Presenting A Voice Unto The Computer</h2>

<p><img alt="deep dreamed surrealism" src="/blog/images/surreal-773fbf3d.png" /></p>

<p>Node.js and npm provide a wonderfully vibrant and delightfully rich ecosystem for making browser-or-terminal-based works of art. Generally I start a project by searching around for existing modules that do what I need, or if there are none then I write the module that does what I need and publish it to npm (<em>nice</em>). With browserify I can use the same code for a CLI tool as I do for a website. </p>

<p>This makes it really easy to explore the full spectrum of possibilities for a given artistic concept or linguistic algorithm in many environments. For example, some modules work well in the browser where you can edit inputs and change paramaters on the fly, while others might be better utilised as part of a command line script. I have heard this style of development and deployment referred to as &ldquo;isomorphic JavaScript&rdquo;, but call it what you will I just think it&rsquo;s darn nifty that this code will run on anything from a refrigerator to a jumbotron. </p>

<p>While there are many Node.js modules available for interfacing with every IO stream that you could possibly connect to your computer, I would like to discuss some Node.js modules that I have published recently which operate purely on, by, for, and around text:</p>

<hr>

<ul>
<li><p><a href="https://github.com/coleww/eat-wrapper">eat-wrapper</a> is a set of helper functions for the Edinburgh Associative Thesauraus, which is kind of like a 70s British pseudo-word-net. One might iterate over a sentence and use it to get random words that are related to that sentence, and then find other sentences that include those related words, and so on.</p></li>
<li><p><a href="https://github.com/coleww/word-vomit">word-vomit</a> accepts a string and randomly replaces certain words in that string with other words that are of the same part of speech. Nice for subtly changing the meaning of a passage through random juxtaposition.</p></li>
<li><p><a href="https://github.com/coleww/n-plus-7">n-plus-7</a> employs a technique of the <a href="https://en.wikipedia.org/wiki/Oulipo">Oulipo</a> whereby each noun in a string is replaced with the seventh noun after that noun in the dictionary. You can replace &ldquo;noun&rdquo; with any list or category of words, and you can also change the offset from seven to any positive or negative integer.</p></li>
<li><p><a href="https://github.com/coleww/poetic-vomit">poetic-vomit</a> is similar to word-vomit, but instead replaces words with a random rhyming word. This is quite useful for generating song lyrics or rhythmic poetry.</p></li>
<li><p><a href="https://github.com/coleww/is-snowball">is-snowball</a> detects whether or not a given string is a &ldquo;snowball&rdquo;, that is, if each word in the string is 1 character longer than the previous one, i.e, &ldquo;o my wow this snowy ballll&rdquo;. The reverse case of descending length can also be detected. This might might be good to throw in the path of a web scraper or tweet stream or the entirety of Project Gutenberg.</p></li>
<li><p><a href="https://github.com/coleww/new-slang">new-slang</a> accepts a map of string sequences to string replacements, and transforms strings of text by replacing those string sequences with the, err, uh, replacements. For example, given a map of <code>{ou: &#39;ooo&#39;}</code> and a string like <code>&#39;you dawg&#39;</code>, this module would return <code>&#39;yooo dawg&#39;</code>. If the function was called over and over with a map like <code>{ou: ooui}</code> and the output of the previous transformation it might produce something similar to <a href="https://github.com/aparrish/linear-lsystem-poetry">Allison Parrish</a>&rsquo;s l-system poem generator.</p></li>
<li><p><a href="https://github.com/coleww/lipogram">lipogram</a> demonstrates another constraint of the Oulipo whereby a given text does not contain a letter or set of letters, for example <a href="https://en.wikipedia.org/wiki/A_Void">A Void by Georges Perec</a> which does not contain the letter e. One could perhaps draw deep meaning from a poem composed out of sentences from Ruby on Rails blog posts that do not contain the letters <code>[&quot;C&quot;, &quot;O&quot;, &quot;M&quot;, &quot;P&quot;, &quot;U&quot;, &quot;T&quot;, &quot;E&quot;, &quot;R&quot;]</code>.</p></li>
<li><p><a href="https://github.com/coleww/each-cons">each-cons</a> does not do anything on it&rsquo;s own&hellip;it is just a helper function that exists in Ruby which I wanted to have available in Node.js without requiring all of underscore/lodash/whatever. This function returns consecutive sequences of an array, so given <code>[1, 2, 3, 4, 5]</code> and a sequence length of <code>3</code>, it would return <code>[[1, 2, 3], [2, 3, 4], [3, 4, 5]]</code>. This is particularly handy for constructing <a href="https://www.khanacademy.org/computing/computer-science/informationtheory/moderninfotheory/v/markov_chains">Markov chains</a>, and, I am certain, other things.</p></li>
<li><p><a href="https://github.com/coleww/diacriticize">diacriticize</a> basically performs a light <a href="http://www.eeemo.net/">zalgo</a> maneuver on the text. It seems to be horridly broken on a lot of platforms, so user beware.</p></li>
<li><p><a href="https://github.com/coleww/to-unicode">to-unicode</a> transforms some text into unicode equivalents, so you can add circles around all yr letters or switch to a mono-spaced font. Like diacriticize, there are some issues sometimes.  <code>¯\_(ツ)_/¯ unicode  ¯\_(ツ)_/¯</code></p></li>
</ul>

<hr>

<p>These modules don&rsquo;t serve any &ldquo;real&rdquo; purpose, but they are fun to make and usually produce amusing output. Furthermore, in my day to day job I am usually almost always making minor adjustments or adding incremental features to user interfaces to RESTful CRUD APIs in a SAAS fashion, so it is rad to get an excuse to design, implement, benchmark, and optimize a real live algorithm. Art is a wonderful excuse to try out something new, whether it be an algorithm, framework, database, or language. I for one first became truly familiar with and enamored by mongoDB by writing a video game inside of it.</p>

<p>Moreover, all of these modules follow what I consider to be best practices for Node.js projects: uses the <a href="https://github.com/feross/standard">standard</a> JavaScript style/linter, has tests, has CI setup to run those tests, has documentation that includes a breakdown of the API for the module and some examples, has a small demo app built that demonstrates what the thing does, and, if it makes sense to, it includes a CLI script version of the module. </p>

<p>Other reasons to use JavaScript to destroy language:</p>

<ul>
<li><a href="https://github.com/dariusk/NaNoGenMo">NaNoGenMo</a>: which, put simply, is an annual event wherein you &ldquo;Spend the month of November writing code that generates a novel of 50k+ words.&rdquo;.</li>
<li><a href="http://tinysubversions.com/2013/09/how-to-make-a-twitter-bot/">twitter bots</a>: make a robot spew nonsense for the world to see! (many of the modules mentioned are being used to power the brain of <a href="https://twitter.com/pataphysyllabus">Hank</a> (also a lot of taylor swift))</li>
<li><a href="http://blog.somewhatabstract.com/2015/03/02/writing-a-simple-slack-bot-with-Node.js-slack-client/">slack bots</a>: make a robot spew nonsense for your co-workers to see! </li>
<li><a href="http://www.tcf.ua.edu/Classes/Jbutler/T340/SurManifesto/ManifestoOfSurrealism.htm">Poetry</a>: it is important.</li>
</ul>

<h3>make a module</h3>

<p>I have many friends and co-workers who agonize over finding a side project to hack on. They don&rsquo;t want to build something that requires costly infrastructure or depends on network effects, but they also don&rsquo;t want to build another TODO app or blogging client. By expanding your conception of the word &ldquo;product&rdquo; to include works of art and poetry, you&rsquo;ll soon discover an endless supply of things to work on. </p>
 -->
  <h2><a href="/blog/overtone-pitching-samples.html">Pitching Samples Around In Overtone</a> <span>Jul 26</span></h2>
  <!-- <h1>Pitching Samples Around In Overtone</h1>

<h2>because sometimes, you&rsquo;re too lazy to sample the entire piano</h2>

<p><img alt="otone" src="/blog/images/otone-1e45a68a.gif" /></p>

<p>For a while now I have been <a href="http://shreddit-hard-co.re/">building interfaces</a> for <a href="http://coleww.github.io/problumz/">creating music</a> with <a href="https://www.npmjs.com/package/drone-e-o-synth">JavaScript and Web Audio</a>, but apparently Overtone already does everything I could ever possibly think of or want. Awesome, my lifes work for nothing.</p>

<p>One of the coolest things about Overtone is that it interfaces directly with <a href="https://www.freesound.org/">Freesound</a>, a database of free audio samples. That means that you can execute <code>(freesound 123456)</code> and the audio file at ID 123456 will be automatically downloaded, stored in <code>.overtone/assets</code>, and played back. I don&rsquo;t know what sample 123456 is, so listener beware&hellip; </p>

<p>With this newly discovered power I began scouring the Freesound website for vocal samples to lay on top of my music. I found this sample pack called <a href="https://www.freesound.org/people/beskhu/packs/4560/">Simplesong (MAC) pitched vocal formants</a> and set out to convert it into a playable instrument along the lines of this <a href="http://blog.josephwilk.net/clojure/creating-instruments-with-overtone.html">blog post by Joseph Wilk</a></p>

<p>Now that I had samples that I liked I just needed to grab their IDs from the website. The aformentioned Joseph Wilk post contains a Ruby script for grabbing ids for a pack, and I also wrote a <a href="https://gist.github.com/coleww/939bc606645c57dd1b29">node script</a> for grabbing IDs based on a query. </p>

<p>Unfortunately, this pack only contained samples of the notes C# A# G and E at various octaves, but I could still play the intermediate pitches by altering the playback rate of the sample. If I wanted to play midi note 34 but I only had a sample for midi note 32 I would just convert both notes to frequencies, divide them, and use the result as the playback value: <code>((freesound 123456) :rate (/ (midi-&gt;hz 34) (midi-&gt;hz 32)))</code>. </p>

<p>With this simple piece of mathematics in hand, I just needed a play function to do all the equations and make some noise:</p>
<pre class="highlight clojure"><code><span class="p">(</span><span class="nf">ns</span><span class="w"> </span><span class="n">syllable-synth.synth</span><span class="w">
  </span><span class="p">(</span><span class="no">:require</span><span class="w"> </span><span class="p">[</span><span class="n">overtone.live</span><span class="w"> </span><span class="no">:refer</span><span class="w"> </span><span class="no">:all</span><span class="p">]))</span><span class="w">

</span><span class="c1">;; object of objects mapping syllable sound to midi note to a freesound sample
</span><span class="p">(</span><span class="k">def</span><span class="w"> </span><span class="n">voices</span><span class="w"> </span><span class="p">{</span><span class="w">

  </span><span class="c1">;; there were many different syllable sounds represented, but for this example we can only make "oooo" sounds
</span><span class="w">  </span><span class="no">:oooo</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="mi">70</span><span class="w"> </span><span class="p">(</span><span class="nf">freesound</span><span class="w"> </span><span class="mi">70529</span><span class="p">)</span><span class="w"> </span><span class="mi">67</span><span class="w"> </span><span class="p">(</span><span class="nf">freesound</span><span class="w"> </span><span class="mi">70528</span><span class="p">)</span><span class="w"> </span><span class="mi">64</span><span class="w"> </span><span class="p">(</span><span class="nf">freesound</span><span class="w"> </span><span class="mi">70527</span><span class="p">)</span><span class="w"> </span><span class="mi">61</span><span class="w"> </span><span class="p">(</span><span class="nf">freesound</span><span class="w"> </span><span class="mi">70526</span><span class="p">)</span><span class="w"> </span><span class="mi">58</span><span class="w"> </span><span class="p">(</span><span class="nf">freesound</span><span class="w"> </span><span class="mi">70525</span><span class="p">)</span><span class="w"> </span><span class="mi">55</span><span class="w"> </span><span class="p">(</span><span class="nf">freesound</span><span class="w"> </span><span class="mi">70524</span><span class="p">)</span><span class="w"> </span><span class="mi">52</span><span class="w"> </span><span class="p">(</span><span class="nf">freesound</span><span class="w"> </span><span class="mi">70523</span><span class="p">)</span><span class="w"> </span><span class="mi">49</span><span class="w"> </span><span class="p">(</span><span class="nf">freesound</span><span class="w"> </span><span class="mi">70522</span><span class="p">)</span><span class="w"> </span><span class="mi">46</span><span class="w"> </span><span class="p">(</span><span class="nf">freesound</span><span class="w"> </span><span class="mi">70521</span><span class="p">)</span><span class="w"> </span><span class="mi">43</span><span class="w"> </span><span class="p">(</span><span class="nf">freesound</span><span class="w"> </span><span class="mi">70520</span><span class="p">)</span><span class="w"> </span><span class="mi">40</span><span class="w"> </span><span class="p">(</span><span class="nf">freesound</span><span class="w"> </span><span class="mi">70519</span><span class="p">)</span><span class="w"> </span><span class="mi">37</span><span class="w"> </span><span class="p">(</span><span class="nf">freesound</span><span class="w"> </span><span class="mi">70518</span><span class="p">)</span><span class="w"> </span><span class="mi">34</span><span class="w"> </span><span class="p">(</span><span class="nf">freesound</span><span class="w"> </span><span class="mi">70517</span><span class="p">)</span><span class="w"> </span><span class="mi">31</span><span class="w"> </span><span class="p">(</span><span class="nf">freesound</span><span class="w"> </span><span class="mi">70516</span><span class="p">)}})</span><span class="w">

</span><span class="p">(</span><span class="k">defn</span><span class="w"> </span><span class="n">play</span><span class="w">
  </span><span class="s">"accepts midi note and syllable to play, uses random if none passed"</span><span class="w">
  </span><span class="p">[</span><span class="n">note</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="p">[</span><span class="n">syll</span><span class="p">]]</span><span class="w">

        </span><span class="c1">;; if no syllable is passed, pick one at random
</span><span class="w">  </span><span class="p">(</span><span class="k">let</span><span class="w"> </span><span class="p">[</span><span class="n">syllable</span><span class="w"> </span><span class="p">(</span><span class="nb">or</span><span class="w"> </span><span class="n">syll</span><span class="w"> </span><span class="p">(</span><span class="nf">rand-nth</span><span class="w"> </span><span class="p">(</span><span class="nb">keys</span><span class="w"> </span><span class="n">voices</span><span class="p">)))</span><span class="w">

        </span><span class="c1">;; grab the notes for which we have a sample 
</span><span class="w">        </span><span class="c1">;; that are lower than the note we want to play
</span><span class="w">        </span><span class="n">notes</span><span class="w"> </span><span class="p">(</span><span class="nb">filter</span><span class="w"> </span><span class="o">#</span><span class="p">(</span><span class="nb">&lt;=</span><span class="w"> </span><span class="n">%</span><span class="w"> </span><span class="n">note</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nb">keys</span><span class="w"> </span><span class="p">(</span><span class="nf">syllable</span><span class="w"> </span><span class="n">voices</span><span class="p">)))</span><span class="w">

        </span><span class="c1">;; our base-note is the highest note in notes, 
</span><span class="w">        </span><span class="c1">;; or 31 if it is lower than 31
</span><span class="w">        </span><span class="n">base-note</span><span class="w"> </span><span class="p">(</span><span class="nb">or</span><span class="w"> </span><span class="p">(</span><span class="nb">last</span><span class="w"> </span><span class="p">(</span><span class="nb">sort</span><span class="w"> </span><span class="n">notes</span><span class="p">)</span><span class="w"> </span><span class="mi">31</span><span class="p">)</span><span class="w">

        </span><span class="c1">;; in order to pitch the base-note up to our desired note, 
</span><span class="w">        </span><span class="c1">;; we convert them both to frequencies and divide
</span><span class="w">        </span><span class="n">rate</span><span class="w"> </span><span class="p">(</span><span class="nb">/</span><span class="w"> </span><span class="p">(</span><span class="nf">midi-&gt;hz</span><span class="w"> </span><span class="n">note</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nf">midi-&gt;hz</span><span class="w"> </span><span class="n">base-note</span><span class="p">))]</span><span class="w">

    </span><span class="c1">;; grab the sample for the given syllable and base-note,
</span><span class="w">    </span><span class="c1">;; and play it back with the rate set 
</span><span class="w">    </span><span class="c1">;; to pitch the sample up the desired note
</span><span class="w">    </span><span class="p">((</span><span class="nb">get</span><span class="w"> </span><span class="p">(</span><span class="nf">syllable</span><span class="w"> </span><span class="n">voices</span><span class="p">)</span><span class="w"> </span><span class="n">base-note</span><span class="p">)</span><span class="w"> </span><span class="no">:rate</span><span class="w"> </span><span class="n">rate</span><span class="p">)))</span><span class="w">


</span><span class="p">(</span><span class="nf">play</span><span class="w"> </span><span class="mi">40</span><span class="p">)</span><span class="w">

</span></code></pre>

<p>You can see the complete code <a href="https://github.com/coleww/my-symphony/blob/master/src/my_symphony/silly-bills.clj">here</a> or see it <a href="https://github.com/coleww/my-symphony/blob/master/src/my_symphony/beat.clj">in action</a>.</p>
 -->
  <h2><a href="/blog/node-cors.html">Building a simple CORS API in node</a> <span>Jul 22</span></h2>
  <!-- <h1>Building a simple CORS API in node</h1>

<h2>TASTE THE ROCKIES</h2>

<p><img alt="cors" src="/blog/images/cors-59d91492.png" /></p>

<p>So you want to build a lil API. Maybe you have some live data to share with the world, maybe you want to make a <a href="http://bikeshed.io/">funny joke</a>, maybe I don&rsquo;t really even care what your reasons are. If you would like lots of people to use your API, you should consider enabling CORS requests so that it can be easily accessed from client side javascript. If you don&rsquo;t, then when people try to use jQuery to hit yr API they will get some horrible error and the whole system will crash. Or they&rsquo;ll have to do some awkward proxying in order to get the data.   It&rsquo;s bad. Trust me.</p>

<p>I&rsquo;m sure there are all kinds of things pre-built for Express or Hapi and probably even just a plain ole&rsquo; NPM module somewhere that does the CORS magic for you, but you know sometimes it&rsquo;s nice to drop down a lil closer to that bare http server metal.</p>

<h3>SHOW ME THE CODE!</h3>
<pre class="highlight javascript"><code><span class="kd">var</span> <span class="nx">http</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">"http"</span><span class="p">)</span>
<span class="kd">var</span> <span class="nx">server</span> <span class="o">=</span> <span class="nx">http</span><span class="p">.</span><span class="nx">createServer</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">setHeader</span><span class="p">(</span><span class="s1">'Access-Control-Allow-Origin'</span><span class="p">,</span> <span class="s1">'*'</span><span class="p">)</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">setHeader</span><span class="p">(</span><span class="s1">'Access-Control-Request-Method'</span><span class="p">,</span> <span class="s1">'*'</span><span class="p">)</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">setHeader</span><span class="p">(</span><span class="s1">'Access-Control-Allow-Methods'</span><span class="p">,</span> <span class="s1">'OPTIONS, GET'</span><span class="p">)</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">setHeader</span><span class="p">(</span><span class="s1">'Access-Control-Allow-Headers'</span><span class="p">,</span> <span class="s1">'*'</span><span class="p">)</span>

  <span class="k">if</span> <span class="p">(</span> <span class="nx">req</span><span class="p">.</span><span class="nx">method</span> <span class="o">===</span> <span class="s1">'OPTIONS'</span> <span class="p">)</span> <span class="p">{</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">writeHead</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">end</span><span class="p">()</span>
    <span class="k">return</span>
  <span class="p">}</span>

  <span class="c1">// do stuff</span>
<span class="p">})</span>
<span class="nx">server</span><span class="p">().</span><span class="nx">listen</span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">PORT</span> <span class="o">||</span> <span class="mi">8000</span><span class="p">)</span>
</code></pre>

<p>You are of course welcome to copy pasta that code snippet and be on your merry way, but I have taken the liberty of reading through some boring technical documents [<a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Access_control_CORS">1</a>, <a href="http://www.w3.org/TR/cors/#access-control-request-method-request-header">2</a>] to try to figure out what the heck this all means:</p>

<p><code>res.setHeader(&#39;Access-Control-Allow-Origin&#39;, &#39;*&#39;)</code>
Here, Origin refers to the URL making the request. If you put &ldquo;*&rdquo; any url will work. If you put a space separated list of urls then only requests coming from those URLs will work, for example: &ldquo;www.geocities.com www.example.com&rdquo;. You can also put &ldquo;null&rdquo; which would mean nothing could access it but that makes no sense so probably just forget it is even an option.</p>

<p><code>res.setHeader(&#39;Access-Control-Request-Method&#39;, &#39;*&#39;)</code>
STRAIGHT FROM THE SPEC: &ldquo;The Access-Control-Request-Method header indicates which method will be used in the actual request as part of the preflight request.&rdquo; TBQH, I have no idea what this means. The star is probably fine. I don&rsquo;t see how this is much different than the next entry:</p>

<p><code>res.setHeader(&#39;Access-Control-Allow-Methods&#39;, &#39;OPTIONS, GET&#39;)</code>
Here you list which HTTP request verbs are allowed. More on the OPTIONS request later. You could obviously add PUT or POST or PATCH or DELETE or actually I think that is it that is all that you can add to this comma separate list. The spec adds a note that &ldquo;The <code>Allow</code> header is not relevant for the purposes of the CORS protocol&rdquo;, so take that as you will.</p>

<p><code>res.setHeader(&#39;Access-Control-Allow-Headers&#39;, &#39;*&#39;)</code>
Much like the All-Methods reqsponse header, here you specify which request header fields to allow. If yr API is super wicked and secret then maybe you should put some controls on it.</p>

<ul>
<li>The Pre-Flight Request</li>
</ul>
<pre class="highlight plaintext"><code>if ( req.method === 'OPTIONS' ) {
  res.writeHead(200)
  res.end()
  return
}
</code></pre>

<p>Sometimes, the CORS request needs to ask the API if it can CORS before it even attempts to CORS. That&rsquo;s pretty weird stuff, but it&rsquo;s also fairly typical as far as how the internets work. Just roll with it: if you get an OPTIONS request, 200 ok it immediately. The response will already contain all the CORS headers that you set, so that whatever is making the OPTIONS request knows what to do next.</p>

<hr>

<p>There you have it! Now your users can access your API using javascript in the browser OR the server, and you can finally build a hexamorphic web application!</p>

<p>You can see the cors in use in <a href="https://github.com/coleww/corpora-api">this project</a>, which basically serves up a directory of JSON files as an API. (but is also sadly not currently deployed anywhere)</p>
 -->
  <h2><a href="/blog/npm-cli.html">Building a *nice* CLI For Your Sick npm Module</a> <span>Jul 16</span></h2>
  <!-- <h1>Building a <em>nice</em> CLI For Your Sick npm Module</h1>

<h2>A tale in backticks</h2>

<p>Ok so you have written a pretty sweet node module. <em>nice</em>. Ok so maybe you want to make this utility available on the command line?</p>

<ul>
<li><p><code>touch cmd.js</code> =&gt; lets make a file!</p></li>
<li><p><code>chmod +x cmd.js</code> =&gt; lets make it executable!</p></li>
<li><p><code>./cmd.js</code> =&gt; doesnt do anything yet!</p></li>
</ul>

<p>But hey, it ran on the command line!</p>

<p>THE END</p>

<p>Ok so open up cmd.js in the text editor of yr choosing and add:</p>

<ul>
<li><p><code>#!/usr/bin/env node</code> =&gt; This tells computer how to run this script</p></li>
<li><p><code>var yrModule = require(&#39;./&#39;)</code> =&gt; Load up that code</p></li>
</ul>

<p>But wait! What about arguments! I have a lot to say!</p>

<p>shhhh go back to the command line:</p>

<ul>
<li><code>npm install yargs --save</code> =&gt; <a href="https://www.npmjs.com/package/yargs">yargs</a> is pretty cool. <a href="https://www.npmjs.com/package/minimist">minimist</a> is also pretty cool. I ended up using yargs due to reasons that I cannot recall. Cool story.</li>
</ul>

<p>Go back to the text editor and add:</p>
<pre class="highlight javascript"><code><span class="kd">var</span> <span class="nx">argv</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'yargs'</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">alias</span><span class="p">(</span><span class="s1">'h'</span><span class="p">,</span> <span class="s1">'help'</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">help</span><span class="p">(</span><span class="s1">'help'</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">usage</span><span class="p">(</span><span class="s1">'what does thing do?'</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">example</span><span class="p">(</span><span class="s1">'yrModule POTATOES!'</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">alias</span><span class="p">(</span><span class="s1">'i'</span><span class="p">,</span> <span class="s1">'intensity'</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">describe</span><span class="p">(</span><span class="s1">'i'</span><span class="p">,</span> <span class="s1">'describe what the arguments do'</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">argv</span>
</code></pre>

<p>Of course&hellip;you should probably edit things to suit yr module. You can chain multiple example/alias/describe calls if you want to show off more functionality or define other options.</p>

<ul>
<li><code>./cmd.js -h</code> =&gt; =&gt; automatic documentation!</li>
</ul>

<p>Once defined, yargs literally does not care how things are passed to it.</p>

<ul>
<li><p><code>./cmd.js -i 72 what is up with airline food?</code> =&gt; ALL GOOD!</p></li>
<li><p><code>./cmd.js what is up with airline food? --intensity=72</code> =&gt; TOTALLY COOL! SAME THING!</p></li>
</ul>

<p>In either case, inside the running cmd.js script the following would be the truth:</p>

<ul>
<li><p><code>argv._</code> =&gt; =&gt; [&lsquo;what&rsquo;, &#39;is&rsquo;, &#39;up&rsquo;, &#39;with&rsquo;, &#39;airline&rsquo;, &#39;food?&rsquo;]</p></li>
<li><p><code>argv.i</code> =&gt; =&gt; 72</p></li>
</ul>

<p>If your module is simple enough, you might be done! Back to the text editor!</p>

<ul>
<li><p><code>var output = yrModule(argv._.join(&quot; &quot;), argv.i)</code> =&gt; pass the arguments to yrModule (maybe it responds to jokes?)</p></li>
<li><p><code>process.stdout.write(output)</code> =&gt; write the output to the terminal</p></li>
<li><p><code>process.exit()</code> =&gt; exit the program</p></li>
</ul>

<p>The UNIX ideology believes that building simple interfaces that accept text input and produce text output are super radical. We are fulfilling that dream right now. To the command line:</p>

<ul>
<li><code>./cmd.js -i 12 awwwwoooooooooooooooooo | grep whales &gt;&gt; save_them.txt</code> =&gt; Amazing.</li>
</ul>

<p>Well, I don&rsquo;t know if yr module has anything to do with whales, but it probably should.</p>

<p>But hey! <code>grep</code> =&gt; accepts that weird <code>|</code> =&gt; pipe thing! Can we accept the weird pipe thing and thus complete our embodiment of the UNIX philosophy?</p>

<p>Yes. Sure. Lets edit some text.</p>

<p>First we wrap our original non-pipey code with an if block:</p>
<pre class="highlight javascript"><code><span class="k">if</span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">stdin</span><span class="p">.</span><span class="nx">isTTY</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">output</span> <span class="o">=</span> <span class="nx">yrModule</span><span class="p">(</span><span class="nx">argv</span><span class="p">.</span><span class="nx">_</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s2">" "</span><span class="p">),</span> <span class="nx">argv</span><span class="p">.</span><span class="nx">i</span><span class="p">)</span>
  <span class="nx">process</span><span class="p">.</span><span class="nx">stdout</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="nx">output</span><span class="p">)</span>
  <span class="nx">process</span><span class="p">.</span><span class="nx">exit</span><span class="p">()</span>
</code></pre>

<ul>
<li><code>process.stdin.isTTY</code> =&gt; basically asks node &ldquo;IS THIS A TERMINAL?&rdquo;</li>
</ul>

<p>And then the else case, for pipey-times:</p>
<pre class="highlight javascript"><code><span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">data</span> <span class="o">=</span> <span class="s1">''</span>
  <span class="nx">process</span><span class="p">.</span><span class="nx">stdin</span><span class="p">.</span><span class="nx">resume</span><span class="p">()</span>
  <span class="nx">process</span><span class="p">.</span><span class="nx">stdin</span><span class="p">.</span><span class="nx">setEncoding</span><span class="p">(</span><span class="s1">'utf8'</span><span class="p">)</span>
  <span class="nx">process</span><span class="p">.</span><span class="nx">stdin</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'data'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">chunk</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">data</span> <span class="o">+=</span> <span class="nx">chunk</span>
  <span class="p">})</span>

  <span class="nx">process</span><span class="p">.</span><span class="nx">stdin</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'end'</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">process</span><span class="p">.</span><span class="nx">stdout</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="nx">yrModule</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="nx">argv</span><span class="p">.</span><span class="nx">i</span><span class="p">))</span>
    <span class="nx">process</span><span class="p">.</span><span class="nx">exit</span><span class="p">()</span>
  <span class="p">})</span>
<span class="p">}</span>
</code></pre>

<ul>
<li><code>cat burrito_recipes.txt | ./cmd.js -i 400</code> =&gt; WOW all kinds of inputs</li>
</ul>

<p>If your module is super complex and might be used on datasets that can&rsquo;t be stored in RAM then you should probably stream the chunks directly into your codes rather than building up a data string and doing it all at once. But this is fine, it&rsquo;s fine, probably fine. Totally.</p>

<p>Cool! Now your module is ready to do all sorts of command line tricks. The last thing you need to remember to do before publishing this update to npm is adding a &ldquo;bin&rdquo; entry to your package.json file so that yr CLI script is available in the PATH of those who install your module. (But if you forget sometimes don&rsquo;t worry about dat inevitable post-npm-publish-version-bump-re-publish it happens to the best of us.)</p>
<pre class="highlight javascript"><code><span class="s2">"bin"</span><span class="err">:</span> <span class="p">{</span>
    <span class="s2">"yrModule"</span><span class="err">:</span> <span class="s2">"cmd.js"</span>
<span class="p">},</span>
</code></pre>

<p>Of course replace yrModule with whatever you want the command line executable to be. In this instance you could do:</p>

<ul>
<li><code>yrModule foo fighters -i 65</code> =&gt; probably make sure you pick a name that isn&rsquo;t already a thing, like <code>git</code>, that would be bad. </li>
</ul>

<p>ONE LAST THING!</p>

<ul>
<li><code>process.exit(1)</code> =&gt; handle yr errors! If yr CLI script fails for some reason, exit with a 1 so that computer knows that a bad thing happened.</li>
</ul>

<p>OK ONE OTHER THING!</p>

<ul>
<li><code>&quot;preferGlobal&quot;: true</code> =&gt; if your script is primarily a CLI tool and wouldn&rsquo;t make much sense as a local project dependency, add this so users get a warning if they don&rsquo;t <code>npm install -g</code>. this would be for things like scaffolding tools or video games.</li>
</ul>

<hr>

<ul>
<li><code>npm publish</code> =&gt; YOU ARE A HERO</li>
</ul>

<p>You can see this sort of thing in action in this <a href="https://github.com/coleww/diacriticize/blob/gh-pages/cmd.js">cmd.js example code from one of my modules</a> as well as this <a href="https://github.com/coleww/mkproj/blob/master/cmd.js">wow, absolute bare minimum here, doesn&rsquo;t even take arguments, barely trying, cool</a></p>
 -->
  <h2><a href="/blog/shelling-out.html">shelling out to the system</a> <span>Jul 10</span></h2>
  <!-- <h1>Shelling Out</h1>

<h2>I would gladly shell out 5$ for you to pipe a burrito to me, streaming, over the course of the next 7 minutes.</h2>

<p>Traditionally in UNIX land one would connect the output of various programs to the inputs of others with pipes (<code>|</code>) directly on the command line, or within the depths of a shell script, like so:</p>

<p><code>cat recipe.txt | grep potatoes &gt;&gt; potato_ideas.txt</code></p>

<p>This is a great way to compose complex actions out of many small utilities.</p>

<p><img alt="pipe" src="/blog/images/pipe-d875ef91.png" /></p>

<p>Piping works fine for non-interactive programs that are all text-in/text-out, and you can certainly write bash scripts that <code>touch</code> and <code>mkdir</code> your way to many victories, but what about integrating more complicated CLI tools like npm, bower, ember, rails, or git? These programs do things like prompt the user to make decisions, hit the network, or generate a metric ton of files, and it might get unwieldy to try to control such chaos directly from the command line. Instead, you can write a script that shells out to them!</p>

<p><img alt="shelling" src="/blog/images/shelling-019c5ed6.png" /></p>

<p>In Ruby, the easiest way to shell out a command is to put it backticks, like so:</p>
<pre class="highlight ruby"><code><span class="c1"># this would print the current directory</span>
<span class="nb">puts</span> <span class="sb">`ls`</span>
</code></pre>

<p>The same shelling, but with Node.js:</p>
<pre class="highlight javascript"><code><span class="kd">var</span> <span class="nx">exec</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'child_process'</span><span class="p">).</span><span class="nx">exec</span>
<span class="nx">exec</span><span class="p">(</span><span class="s1">'ls'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">stdout</span><span class="p">,</span> <span class="nx">stderr</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// this would print the current directory</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">stdout</span><span class="p">)</span>

  <span class="c1">// probably some callback hell here</span>
<span class="p">});</span>
</code></pre>

<p>With these, you can easily run shell commands and respond to their output as part of your script. But what if instead of just running a command you want to turn over control to a different program? Maybe that program has user prompts that need answering or it shows some pretty sweet terminal graphics.</p>

<p>In Ruby you can use <code>exec</code>, which replaces the current process with the given command:</p>
<pre class="highlight ruby"><code><span class="nb">exec</span> <span class="s2">"rails new monolith"</span>
<span class="nb">puts</span> <span class="s2">"never gets here cuz rails takes over"</span>
</code></pre>

<p>In Node.js there is the <a href="https://www.npmjs.com/package/kexec">kexec</a> module, which does the exact same thing:</p>
<pre class="highlight javascript"><code><span class="kd">var</span> <span class="nx">kexec</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'kexec'</span><span class="p">)</span>
<span class="nx">kexec</span><span class="p">(</span><span class="s1">'ember new behemoth'</span><span class="p">)</span>
</code></pre>

<p>I used some of these magical spells to build <a href="https://github.com/coleww/mkproj">mkproj</a>, which generates a bunch of files and does some NPM stuff in order to scaffold lil browserify projects. Being able to run code on the command line from a Ruby or Node script opens up tons of possibilities for destroying your computer in a for loop! Reader beware!</p>
 -->
  <h2><a href="/blog/do-cron.html">automating bots with cron on digital ocean</a> <span>Jun 23</span></h2>
  <!-- <h1>automating bots with cron on digital ocean</h1>

<h2>because setInterval is probably not the right thing to do</h2>

<p>I used to deploy all my bots to Heroku, running in constant loops on those sweet sweet free single dynos.</p>

<p>They looked something like this:</p>
<pre class="highlight ruby"><code>    <span class="kp">loop</span> <span class="k">do</span>
        <span class="c1"># do some stuff</span>
        <span class="no">BOT</span><span class="p">.</span><span class="nf">post</span><span class="p">(</span><span class="n">funny_tweet_lol</span><span class="p">)</span>
        <span class="nb">sleep</span> <span class="mi">10800</span> <span class="o">+</span> <span class="p">(</span><span class="nb">rand</span> <span class="mi">5400</span><span class="p">)</span>
    <span class="k">end</span>
</code></pre>

<p>This is&hellip;not optimal for a number of reasons. But since I could create new Heroku apps for free from the command line it was super easy, and, well, why not. I even made a <a href="https://github.com/coleww/twitter_bot_generator">twitter bot generator ruby gem</a> around the concept. Don&rsquo;t judge me.</p>

<p>With deng near fifty of these things running, I was not much pleased to hear about the new Heroku pricing plan. Though of course I couldn&rsquo;t get mad cuz it was free servers in the first place. While I could have meticulously gone through all my Heroku apps and updated them to not loop/sleep forever and instead scheduled the scripts to run at various intervals, I figured it was finally time to get close to that cloud server metal and put together a lil droplet for myself in the Digital Ocean.</p>

<p>There are many tutorials on setting up virtual servers, but I found that the biggest pain point in the process was getting my scripts to run on a schedule with cron.  It turns out that cron jobs are run with a very minimal environment setup, for reasons that I guess are cool. You can look up why but honestly it&rsquo;s totally boring.</p>

<p><img alt="corn" src="/blog/images/corn-0b0b5915.jpg" /></p>

<ul>
<li>WHY IS THERE NO NODE.JS HERE?!</li>
</ul>

<p>Even though I had installed all the nodes and rubies, my cron seemed to just ignore them. I thought that was quite rude. To fix this, you just need to export your path. Enter <code>echo PATH=$PATH</code> and copy paste the output into your crontab.</p>

<p>This was what I saw:</p>
<pre class="highlight plaintext"><code>root@1404-64:~# echo PATH=$PATH
PATH=/root/.nvm/versions/v0.12.2/bin:/usr/local/rvm/gems/ruby-2.2.1/bin:/usr/local/rvm/gems/ruby-2.2.1@global/bin:/usr/local/rvm/rubies/ruby-2.2.1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/usr/local/rvm/bin
</code></pre>

<p>And just dump it in the <code>crontab -e</code> before your job listings.</p>
<pre class="highlight plaintext"><code>#
# For more information see the manual pages of crontab(5) and cron(8)
#
# m h  dom mon dow   command
PATH=/root/.nvm/versions/v0.12.2/bin:/usr/local/rvm/gems/ruby-2.2.1/bin:/usr/local/rvm/gems/ruby-2.2.1@global/bin:/usr/local/rvm/rubies/ruby-2.2.1/bin:/usr$
</code></pre>

<ul>
<li>.././../././relative paths :&lt;</li>
</ul>

<p>Now I had node, but my require(&rsquo;./module&rsquo;) calls didn&rsquo;t seem to work! Cron apparently is not only PATHless but also pathless. My crons looked something like <code>* * * * * node bots/lolbot/bot.js &gt;&gt; ~/lol.log</code> but in order to correctly set my working path, I just had to <code>cd</code> into the parent directory before running the script, like so: <code>* * * * * cd bots/lolbot &amp;&amp; node bot.js &gt;&gt; ~/lol.log</code>.</p>

<hr>

<p>This &ldquo;blog post&rdquo; was <a href="https://twitter.com/colewillsea/lists/my-robots">tested</a> on a 512MB Ram20GB SSD Disk Ubuntu 14.04 x64 Digital Ocean droplet but will probably apply for pretty much any linux-y system anywhere.</p>
 -->
  <h2><a href="/blog/trigger-loading-route-in-ember.html">Manually Trigger Loading Routes in Ember</a> <span>Jun  9</span></h2>
  <!-- <h1>Manually Trigger Loading Routes in Ember</h1>

<h2>cuz Ember can&rsquo;t do  e v e r y t h i n g  for you</h2>

<p>Loading routes in Ember are pretty frigging sweet. You can drop a spinner .gif pretty much any frigging where you want. You can even make nested loading routes: it&rsquo;s frigging awesome.</p>

<p>One trick, however, is making use of those loading routes when persisting customer informatin to your datbase. The loading routes automagically hop into place while you are fetching data, but they can&rsquo;t do the same when saving it. That would be weird and unfortunate.</p>

<p>Instead, you must explicitly tell the router that you are loading some stuff and to just chill the frig out for a second while you figure some things out.</p>

<p>FOR EXAMPLE (presuming you are on the user.edit route, editing yrself):</p>
<pre class="highlight javascript"><code><span class="nx">saveUserInformation</span><span class="p">(){</span>

  <span class="c1">// MANUALLY TRANSITIONING TO THE LOADING ROUTE</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">transitionTo</span><span class="p">(</span><span class="s1">'loading'</span><span class="p">);</span>

  <span class="c1">// return a promise whose `then` and `catch` callbacks each transition to an appropriate route</span>
  <span class="k">return</span> <span class="nx">user</span><span class="p">.</span><span class="nx">save</span><span class="p">().</span><span class="nx">then</span><span class="p">(()</span><span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">transitionTo</span><span class="p">(</span><span class="s1">'user.index'</span><span class="p">);</span>
    <span class="c1">// success! go to the infernal User index and suffer with the rest of them!</span>

  <span class="p">}).</span><span class="k">catch</span><span class="p">((</span><span class="nx">e</span><span class="p">)</span><span class="o">=&gt;</span> <span class="p">{</span>
    <span class="c1">// do something to User with the `e` errors --&gt; very bad... show warning/</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">transitionTo</span><span class="p">(</span><span class="s1">'user.edit'</span><span class="p">,</span> <span class="nx">user</span><span class="p">);</span>
    <span class="c1">// return to the current page, with the current model data all still set like WOWWW</span>
  <span class="p">});</span>
<span class="p">}</span>
</code></pre>

<p>A N D   T H A T S    I T</p>

<p>Just a simple <code>this.transitionTo(&#39;loading&#39;)</code> and you can punt the Ember route back into loading mode. Try it today!</p>
 -->
  <h2><a href="/blog/eating-glue-and-paste.html">Eating Glue</a> <span>Jun  3</span></h2>
  <!-- <h1>EATING GLUE</h1>

<h2>Taking Over the Paste Event</h2>

<p>Though they started out as simple document viewers, over the years web browsers have escaped from their sandbox and gained more and more access to operating system level goodness, like your camera and GPS coordinates. This level of intrusivenes used to only be possible for those with the skills and courage to wield awkward Flash hacks, but today this sort of stuff is made available through simple JavaScript APIs to every website you visit. <em>Awesome.</em></p>

<p><img alt="Ralph likes to hack JavaScript" src="/blog/images/paste-5dc5c384.jpg" /></p>

<p>One basic computer technology that we can hijack and manipulate however we please is pasting. Some people think it&rsquo;s wrong to mess with fundamental UI behavior like clicking or scrolling or, I suppose, <code>ctrl+v</code>, but I say SHOW ME THE CODE:</p>
<pre class="highlight javascript"><code>    <span class="c1">// take over any paste event that occurs on this page</span>
    <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">'paste'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">){</span>
      <span class="kd">var</span> <span class="nx">data</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">clipboardData</span><span class="p">.</span><span class="nx">getData</span><span class="p">(</span><span class="s1">'text/plain'</span><span class="p">)</span>

      <span class="nx">alert</span><span class="p">(</span><span class="s1">'YOU TRIED TO PASTE '</span> <span class="o">+</span> <span class="nx">data</span> <span class="o">+</span> <span class="s1">', TOO BAD.'</span><span class="p">)</span>

      <span class="k">return</span> <span class="kc">false</span> <span class="c1">// don't let the normal "paste" event happen</span>
    <span class="p">})</span>
</code></pre>

<p>And that&rsquo;s it!</p>

<p><a href="http://stackoverflow.com/questions/6035071/intercept-paste-event-in-javascript">According to my in depth research into this subject</a> you need to use <code>window.clipboardData.getData(&#39;Text&#39;)</code> in IE, or <code>e.originalEvent.clipboardData</code> if you install the event handler with something called &ldquo;Jquery&rdquo;.</p>

<h4>ok but why</h4>

<p>I used this trick to build a <a href="http://coleww.github.io/json-formatter/">JSON formatter</a> [<a href="https://github.com/coleww/json-formatter">code</a>] because I wanted to quickly paste a JSON blob to the page and see it transformed, and an input field or textarea would just get in the way of things. Most JSON formatters on the web are laden with options and advertisements, but all I really needed was a quick way to inspect API responses.</p>

<p>By hacking the paste event, I was able to take something that looked like this:</p>

<p><img alt="before" src="/blog/images/json-og-ba891b43.png" /></p>

<p>And make it work more like this:</p>

<p><img alt="after" src="/blog/images/json-example-c07746ca.gif" /></p>

<p>This approach is well aligned with the UNIX philosophy, which holds among it&rsquo;s tenets &ldquo;make small things&rdquo; and &ldquo;text in/text out&rdquo;. Only in this instance, input is handled by the paste event and the output is a div. The web page itself does only one thing and nothing else (literally, there isn&rsquo;t even a title or attribution) which means it composes well with other &ldquo;modules&rdquo; in the browser, like for example using <code>cmd+f</code> to find things in the formatted JSON. And if I needed to add an option for controlling the indentation level or something I could perhaps add it as a query param in the URL.</p>

<p>The JSON formatter is actually just a wrapper around a node module called <a href="https://github.com/JerrySievert/json">json-nice</a>, and there are probably many other small command line tools that could benefit from being turned into tiny web apps. With <a href="https://github.com/substack/browserify-handbook">browserify</a> and <a href="http://maxogden.com/node-packaged-modules.html">npm</a> this becomes really easy.</p>
 -->
  <h2><a href="/blog/syntax-highlighting-in-middleman.html">100% EZ Syntax Highlighting With Middleman</a> <span>May 30</span></h2>
  <!-- <h1>100% EZ Syntax Highlighting With Middleman</h1>

<h2>A Meta Blog About This Middleman Blog</h2>

<p>I just got these nifty syntax-highlighted-code-blocks working so I thought to myself &ldquo;why not write a blog about setting up my blog? what could possibly be more fascinating?&rdquo;. The answers to those questions being &ldquo;there is no reason not to&rdquo; and &ldquo;nothing&rdquo; respectively.</p>

<p>We&rsquo;ll be using the <a href="https://github.com/middleman/middleman-syntax">middleman-syntax gem</a> in a standard, run-of-the-mill, fresh from the generator, uncustomized Middleman project.</p>

<h4>Step 1: Add some gems to the <code>/Gemfile</code> and <code>bundle install</code></h4>
<pre class="highlight ruby"><code>    <span class="n">gem</span> <span class="s2">"middleman-syntax"</span>
    <span class="n">gem</span> <span class="s2">"redcarpet"</span>
</code></pre>

<p>middleman-syntax will work with other markdown parsers, but if you&rsquo;re at all like me you don&rsquo;t really care what is parsing your markdown, so I went with <a href="https://github.com/vmg/redcarpet">redcarpet</a> because it&rsquo;s what Github uses and that&rsquo;s usually where I&rsquo;m writing markdown.</p>

<h4>Step 2: Add these lines to the bottom of <code>/config.rb</code></h4>
<pre class="highlight ruby"><code>    <span class="n">activate</span> <span class="ss">:syntax</span>
    <span class="n">set</span> <span class="ss">:markdown_engine</span><span class="p">,</span> <span class="ss">:redcarpet</span>
    <span class="n">set</span> <span class="ss">:markdown</span><span class="p">,</span> <span class="ss">:fenced_code_blocks</span> <span class="o">=&gt;</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">:smartypants</span> <span class="o">=&gt;</span> <span class="kp">true</span>
</code></pre>

<p><code>fenced_code_blocks</code> adds a familiar and pretty background to help set your code blocks apart from the mere plain text that surrounds them. I have absolutely no idea what <code>smartypants</code> is and the <a href="https://middlemanapp.com/basics/template_engine_options/">middleman docs</a> aren&rsquo;t much help in this area, but I left it set to true because why wouldn&rsquo;t you want a pair of smart pants?</p>

<h4>Step 3: Create a file name <code>highlighting.css.erb</code> inside <code>/source/stylesheets</code> and add this line</h4>
<pre class="highlight erb"><code>    <span class="cp">&lt;%=</span> <span class="no">Rouge</span><span class="o">::</span><span class="no">Themes</span><span class="o">::</span><span class="no">Github</span><span class="p">.</span><span class="nf">render</span><span class="p">(</span><span class="ss">:scope</span> <span class="o">=&gt;</span> <span class="s1">'.highlight'</span><span class="p">)</span> <span class="cp">%&gt;</span>
</code></pre>

<p><a href="https://github.com/jneen/rouge">Rouge</a> is the actual library doing the syntax highlighting, and the documentation tells me that you can also try out these themes: <code>ThankfulEyes</code>, <code>Colorful</code>, <code>Github</code>, <code>Base16</code>, <code>Base16::Solarized</code>, <code>Base16::Monokai</code>, <code>Monokai</code>. I went with Github in the hopes that it would help make developers feel at home reading my blog.</p>

<h4>Step 4: Reference the generated CSS in the head tag of your <code>/source/layout.erb</code> file</h4>
<pre class="highlight erb"><code>    <span class="cp">&lt;%=</span> <span class="n">stylesheet_link_tag</span> <span class="s2">"highlighting"</span> <span class="cp">%&gt;</span>
</code></pre>

<p>Middleman, much like Rails, has an asset pipeline which you can probably use to mix this file in with your other styles and export into a single minified, uglified, bonafide, electrified six-car monorail. But I don&rsquo;t really understand CSS stuff (I mean, just <em>look</em> at this website) so ask someone else about that.</p>

<h4>Step 5: Write about some code!</h4>

<p>You now can use code blocks in your markdown and get awesome highlighted syntax! Just use the triple backticks markdown blocks, and put the language name after the first set of backticks, like so:</p>
<pre class="highlight plaintext"><code>    ```ruby
        puts "YOU ARE A CHAMPION NOW!"
    ```
</code></pre>

<p>A full list of supported languages/syntaxes can be found <a href="https://github.com/jneen/rouge/wiki/List-of-supported-languages-and-lexers">here</a>.</p>
 -->


      <br/>
      <br/>
      <br/>
      <br/>
      <br/>
      <br/>
      <br/>
      <br/>
      <br/>
      <br/>
      <br/>
      <br/>
    </div>

    <aside>
      <p><div id="contact">
        <a href="http://colewillsea.com/">Cole Willsea</a>
        (<a href="https://github.com/coleww">github</a>)
        (<a href="https://twitter.com/colewillsea">twitter</a>)
      </div></p>
      <h2>RECENT BLAGZ</h2>
      <ul>
          <li><a href="/blog/node-poetry-modules.html">Node.js Poetic Modules</a> <span>Aug  1</span></li>
          <li><a href="/blog/overtone-pitching-samples.html">Pitching Samples Around In Overtone</a> <span>Jul 26</span></li>
          <li><a href="/blog/node-cors.html">Building a simple CORS API in node</a> <span>Jul 22</span></li>
          <li><a href="/blog/npm-cli.html">Building a *nice* CLI For Your Sick npm Module</a> <span>Jul 16</span></li>
          <li><a href="/blog/shelling-out.html">shelling out to the system</a> <span>Jul 10</span></li>
      </ul>

      <h2>TAGZ</h2>
      <ul>
          <li><a href="/blog/tags/unix.html">UNIX (5)</a></li>
          <li><a href="/blog/tags/node.html">node (3)</a></li>
          <li><a href="/blog/tags/command-line.html">command line (2)</a></li>
          <li><a href="/blog/tags/npm.html">npm (2)</a></li>
          <li><a href="/blog/tags/ruby.html">ruby (2)</a></li>
          <li><a href="/blog/tags/bash.html">bash (2)</a></li>
          <li><a href="/blog/tags/middleman.html">middleman (1)</a></li>
          <li><a href="/blog/tags/paste-events.html">paste events (1)</a></li>
          <li><a href="/blog/tags/browser-hijacking.html">browser hijacking (1)</a></li>
          <li><a href="/blog/tags/magic.html">magic (1)</a></li>
          <li><a href="/blog/tags/glue.html">glue (1)</a></li>
          <li><a href="/blog/tags/markdown.html">markdown (1)</a></li>
          <li><a href="/blog/tags/ember.html">ember (1)</a></li>
          <li><a href="/blog/tags/loading-routes.html">loading routes (1)</a></li>
          <li><a href="/blog/tags/spinner-gif.html">spinner gif (1)</a></li>
          <li><a href="/blog/tags/tom-dale.html">tom dale (1)</a></li>
          <li><a href="/blog/tags/cron-job.html">cron job (1)</a></li>
          <li><a href="/blog/tags/digital-ocean.html">digital ocean (1)</a></li>
          <li><a href="/blog/tags/twitter-bots.html">twitter bots (1)</a></li>
          <li><a href="/blog/tags/path.html">path (1)</a></li>
          <li><a href="/blog/tags/ubuntu.html">ubuntu (1)</a></li>
          <li><a href="/blog/tags/shell-scripts.html">shell scripts (1)</a></li>
          <li><a href="/blog/tags/john-gruber.html">john gruber (1)</a></li>
          <li><a href="/blog/tags/exec.html">exec (1)</a></li>
          <li><a href="/blog/tags/kexec.html">kexec (1)</a></li>
          <li><a href="/blog/tags/meta-blog.html">meta-blog (1)</a></li>
          <li><a href="/blog/tags/code.html">code (1)</a></li>
          <li><a href="/blog/tags/syntax-highlighting.html">syntax highlighting (1)</a></li>
          <li><a href="/blog/tags/cli-tool.html">cli tool (1)</a></li>
          <li><a href="/blog/tags/pipe.html">pipe (1)</a></li>
          <li><a href="/blog/tags/unix.html">unix (1)</a></li>
          <li><a href="/blog/tags/yargs.html">yargs (1)</a></li>
          <li><a href="/blog/tags/cors.html">cors (1)</a></li>
          <li><a href="/blog/tags/api.html">api (1)</a></li>
          <li><a href="/blog/tags/http.html">http (1)</a></li>
          <li><a href="/blog/tags/the-rocky-mountain-brew.html">the rocky mountain brew (1)</a></li>
          <li><a href="/blog/tags/overtone.html">overtone (1)</a></li>
          <li><a href="/blog/tags/clojure.html">clojure (1)</a></li>
          <li><a href="/blog/tags/noise.html">noise (1)</a></li>
          <li><a href="/blog/tags/pitch.html">pitch (1)</a></li>
          <li><a href="/blog/tags/samples.html">samples (1)</a></li>
          <li><a href="/blog/tags/music.html">music (1)</a></li>
          <li><a href="/blog/tags/node-js.html">Node.js (1)</a></li>
          <li><a href="/blog/tags/poetry.html">poetry (1)</a></li>
          <li><a href="/blog/tags/literature.html">literature (1)</a></li>
      </ul>
    </aside>
    <script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(["_setAccount", "UA-26036675-1"]);
  _gaq.push(["_trackPageview"]);
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? '//ssl' : '//www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>

  </body>
</html>
