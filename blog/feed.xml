<?xml version="1.0" encoding="UTF-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Cole Willsea</title>
  <subtitle>Cole Codes Cool Code</subtitle>
  <id>http://colewillsea.com/</id>
  <link href="http://colewillsea.com/"/>
  <link href="http://colewillsea.com/feed.xml" rel="self"/>
  <updated>2015-07-26T13:53:00-07:00</updated>
  <author>
    <name>Cole Willsea</name>
  </author>
  <entry>
    <title>Pitching Samples Around In Overtone</title>
    <link rel="alternate" href="http://colewillsea.com/blog/overtone-pitching-samples.html"/>
    <id>http://colewillsea.com/blog/overtone-pitching-samples.html</id>
    <published>2015-07-26T13:53:00-07:00</published>
    <updated>2015-07-26T14:35:50-07:00</updated>
    <author>
      <name>Article Author</name>
    </author>
    <content type="html">&lt;h1&gt;Pitching Samples Around In Overtone&lt;/h1&gt;

&lt;h2&gt;because sometimes, you&amp;rsquo;re too lazy to sample the entire piano&lt;/h2&gt;

&lt;p&gt;&lt;img alt="otone" src="/blog/images/otone.gif" /&gt;&lt;/p&gt;

&lt;p&gt;For a while now I have been &lt;a href="http://shreddit-hard-co.re/"&gt;building interfaces&lt;/a&gt; for &lt;a href="http://coleww.github.io/problumz/"&gt;creating music&lt;/a&gt; with &lt;a href="https://www.npmjs.com/package/drone-e-o-synth"&gt;JavaScript and Web Audio&lt;/a&gt;, but apparently Overtone already does everything I could ever possibly think of or want. Cool, my lifes work for nothing.&lt;/p&gt;

&lt;p&gt;One of the coolest things about Overtone is that it interfaces directly with &lt;a href="https://www.freesound.org/"&gt;Freesound&lt;/a&gt;, a database of free audio samples. That means that you can execute &lt;code&gt;(freesound 123456)&lt;/code&gt; and the audio file at ID 123456 will be automatically downloaded, stored in &lt;code&gt;.overtone/assets&lt;/code&gt;, and played back. I don&amp;rsquo;t know what sample 123456 is, so listener beware&amp;hellip; &lt;/p&gt;

&lt;p&gt;With this newly discovered power I began scouring the Freesound website for vocal samples to lay on top of my music. I found this sample pack called &lt;a href="https://www.freesound.org/people/beskhu/packs/4560/"&gt;Simplesong (MAC) pitched vocal formants&lt;/a&gt; and set out to convert it into an instrument along the lines of this &lt;a href="http://blog.josephwilk.net/clojure/creating-instruments-with-overtone.html"&gt;blog post by Joseph Wilk&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Now that I had samples that I liked I just needed to grab their IDs from the website. The aformentioned Joseph Wilk post contains a Ruby script for grabbing ids for a pack, and I also wrote a &lt;a href="https://gist.github.com/coleww/939bc606645c57dd1b29"&gt;node script&lt;/a&gt; for grabbing IDs based on a query. &lt;/p&gt;

&lt;p&gt;Unfortunately, this pack only contained samples of the notes C# A# G and E at various octaves, but I could still play the intermediate pitches by altering the playback rate of the sample. If I wanted to play midi note 34 but I only had a sample for midi note 32 I would just convert both notes to frequencies, divide them, and use the result as the playback value: &lt;code&gt;((freesound 123456) :rate (/ (midi-&amp;gt;hz 34) (midi-&amp;gt;hz 32)))&lt;/code&gt;. &lt;/p&gt;

&lt;p&gt;With this simple piece of mathematics in hand, I just needed a play function to do all the equations and make some noise:&lt;/p&gt;
&lt;pre class="highlight clojure"&gt;&lt;code&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;ns&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;syllable-synth.synth&lt;/span&gt;&lt;span class="w"&gt;
  &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="no"&gt;:require&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;overtone.live&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="no"&gt;:refer&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="no"&gt;:all&lt;/span&gt;&lt;span class="p"&gt;]))&lt;/span&gt;&lt;span class="w"&gt;

&lt;/span&gt;&lt;span class="c1"&gt;;; object of objects mapping syllable sound to midi note to a freesound sample
&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;def&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;voices&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;

  &lt;/span&gt;&lt;span class="c1"&gt;;; there were many different syllable sounds represented, but for this example we can only make "oooo" sounds
&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="no"&gt;:oooo&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
    &lt;/span&gt;&lt;span class="mi"&gt;70&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;freesound&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;70529&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;67&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;freesound&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;70528&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;64&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;freesound&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;70527&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;61&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;freesound&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;70526&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;58&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;freesound&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;70525&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;55&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;freesound&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;70524&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;52&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;freesound&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;70523&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;49&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;freesound&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;70522&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;46&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;freesound&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;70521&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;43&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;freesound&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;70520&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;40&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;freesound&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;70519&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;37&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;freesound&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;70518&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;34&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;freesound&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;70517&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;31&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;freesound&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;70516&lt;/span&gt;&lt;span class="p"&gt;)}})&lt;/span&gt;&lt;span class="w"&gt;

&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;defn&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;play&lt;/span&gt;&lt;span class="w"&gt;
  &lt;/span&gt;&lt;span class="s"&gt;"accepts midi note and syllable to play, uses random if none passed"&lt;/span&gt;&lt;span class="w"&gt;
  &lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;note&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;amp;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;syll&lt;/span&gt;&lt;span class="p"&gt;]]&lt;/span&gt;&lt;span class="w"&gt;

        &lt;/span&gt;&lt;span class="c1"&gt;;; if no syllable is passed, pick one at random
&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;let&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;syllable&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;or&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;syll&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;rand-nth&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;keys&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;voices&lt;/span&gt;&lt;span class="p"&gt;)))&lt;/span&gt;&lt;span class="w"&gt;

        &lt;/span&gt;&lt;span class="c1"&gt;;; grab the notes for which we have a sample 
&lt;/span&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="c1"&gt;;; that are lower than the note we want to play
&lt;/span&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="n"&gt;notes&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;filter&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;#&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;&amp;lt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;%&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;note&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;keys&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;syllable&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;voices&lt;/span&gt;&lt;span class="p"&gt;)))&lt;/span&gt;&lt;span class="w"&gt;

        &lt;/span&gt;&lt;span class="c1"&gt;;; our base-note is the highest note in notes, 
&lt;/span&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="c1"&gt;;; or 31 if it is lower than 31
&lt;/span&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="n"&gt;base-note&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;or&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;last&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;sort&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;notes&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;31&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;

        &lt;/span&gt;&lt;span class="c1"&gt;;; in order to pitch the base-note up to our desired note, 
&lt;/span&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="c1"&gt;;; we convert them both to frequencies and divide
&lt;/span&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="n"&gt;rate&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;/&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;midi-&amp;gt;hz&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;note&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;midi-&amp;gt;hz&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;base-note&lt;/span&gt;&lt;span class="p"&gt;))]&lt;/span&gt;&lt;span class="w"&gt;

    &lt;/span&gt;&lt;span class="c1"&gt;;; grab the sample for the given syllable and base-note,
&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="c1"&gt;;; and play it back with the rate set 
&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="c1"&gt;;; to pitch the sample up the desired note
&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="p"&gt;((&lt;/span&gt;&lt;span class="nb"&gt;get&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;syllable&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;voices&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;base-note&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="no"&gt;:rate&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;rate&lt;/span&gt;&lt;span class="p"&gt;)))&lt;/span&gt;&lt;span class="w"&gt;


&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;play&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;40&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;

&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;You can see the complete code &lt;a href="https://github.com/coleww/my-symphony/blob/master/src/my_symphony/silly-bills.clj"&gt;here&lt;/a&gt; or see it &lt;a href="https://github.com/coleww/my-symphony/blob/master/src/my_symphony/beat.clj"&gt;in action&lt;/a&gt;.&lt;/p&gt;
</content>
  </entry>
  <entry>
    <title>Building a simple CORS API in node</title>
    <link rel="alternate" href="http://colewillsea.com/blog/node-cors.html"/>
    <id>http://colewillsea.com/blog/node-cors.html</id>
    <published>2015-07-22T08:09:00-07:00</published>
    <updated>2015-07-26T14:41:39-07:00</updated>
    <author>
      <name>Article Author</name>
    </author>
    <content type="html">&lt;h1&gt;Building a simple CORS API in node&lt;/h1&gt;

&lt;h2&gt;TASTE THE ROCKIES&lt;/h2&gt;

&lt;p&gt;&lt;img alt="cors" src="/blog/images/cors.png" /&gt;&lt;/p&gt;

&lt;p&gt;So you want to build a lil API. Maybe you have some live data to share with the world, maybe you want to make a &lt;a href="http://bikeshed.io/"&gt;funny joke&lt;/a&gt;, maybe I don&amp;rsquo;t really even care what your reasons are. If you would like lots of people to use your API, you should consider enabling CORS requests so that it can be easily accessed from client side javascript. If you don&amp;rsquo;t, then when people try to use jQuery to hit yr API they will get some horrible error and the whole system will crash. Or they&amp;rsquo;ll have to do some awkward proxying in order to get the data.   It&amp;rsquo;s bad. Trust me.&lt;/p&gt;

&lt;p&gt;I&amp;rsquo;m sure there are all kinds of things pre-built for Express or Hapi and probably even just a plain ole&amp;rsquo; NPM module somewhere that does the CORS magic for you, but you know sometimes it&amp;rsquo;s nice to drop down a lil closer to that bare http server metal.&lt;/p&gt;

&lt;h3&gt;SHOW ME THE CODE!&lt;/h3&gt;
&lt;pre class="highlight javascript"&gt;&lt;code&gt;&lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;http&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;require&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;"http"&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;server&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;http&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;createServer&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kd"&gt;function&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;req&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;res&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="nx"&gt;res&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;setHeader&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'Access-Control-Allow-Origin'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;'*'&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
  &lt;span class="nx"&gt;res&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;setHeader&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'Access-Control-Request-Method'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;'*'&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
  &lt;span class="nx"&gt;res&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;setHeader&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'Access-Control-Allow-Methods'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;'OPTIONS, GET'&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
  &lt;span class="nx"&gt;res&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;setHeader&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'Access-Control-Allow-Headers'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;'*'&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

  &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt; &lt;span class="nx"&gt;req&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;method&lt;/span&gt; &lt;span class="o"&gt;===&lt;/span&gt; &lt;span class="s1"&gt;'OPTIONS'&lt;/span&gt; &lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="nx"&gt;res&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;writeHead&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;200&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="nx"&gt;res&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;end&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt;
  &lt;span class="p"&gt;}&lt;/span&gt;

  &lt;span class="c1"&gt;// do stuff&lt;/span&gt;
&lt;span class="p"&gt;})&lt;/span&gt;
&lt;span class="nx"&gt;server&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="nx"&gt;listen&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;process&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;env&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;PORT&lt;/span&gt; &lt;span class="o"&gt;||&lt;/span&gt; &lt;span class="mi"&gt;8000&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;You are of course welcome to copy pasta that code snippet and be on your merry way, but I have taken the liberty of reading through some boring technical documents [&lt;a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Access_control_CORS"&gt;1&lt;/a&gt;, &lt;a href="http://www.w3.org/TR/cors/#access-control-request-method-request-header"&gt;2&lt;/a&gt;] to try to figure out what the heck this all means:&lt;/p&gt;

&lt;p&gt;&lt;code&gt;res.setHeader(&amp;#39;Access-Control-Allow-Origin&amp;#39;, &amp;#39;*&amp;#39;)&lt;/code&gt;
Here, Origin refers to the URL making the request. If you put &amp;ldquo;*&amp;rdquo; any url will work. If you put a space separated list of urls then only requests coming from those URLs will work, for example: &amp;ldquo;www.geocities.com www.example.com&amp;rdquo;. You can also put &amp;ldquo;null&amp;rdquo; which would mean nothing could access it but that makes no sense so probably just forget it is even an option.&lt;/p&gt;

&lt;p&gt;&lt;code&gt;res.setHeader(&amp;#39;Access-Control-Request-Method&amp;#39;, &amp;#39;*&amp;#39;)&lt;/code&gt;
STRAIGHT FROM THE SPEC: &amp;ldquo;The Access-Control-Request-Method header indicates which method will be used in the actual request as part of the preflight request.&amp;rdquo; TBQH, I have no idea what this means. The star is probably fine. I don&amp;rsquo;t see how this is much different than the next entry:&lt;/p&gt;

&lt;p&gt;&lt;code&gt;res.setHeader(&amp;#39;Access-Control-Allow-Methods&amp;#39;, &amp;#39;OPTIONS, GET&amp;#39;)&lt;/code&gt;
Here you list which HTTP request verbs are allowed. More on the OPTIONS request later. You could obviously add PUT or POST or PATCH or DELETE or actually I think that is it that is all that you can add to this comma separate list. The spec adds a note that &amp;ldquo;The &lt;code&gt;Allow&lt;/code&gt; header is not relevant for the purposes of the CORS protocol&amp;rdquo;, so take that as you will.&lt;/p&gt;

&lt;p&gt;&lt;code&gt;res.setHeader(&amp;#39;Access-Control-Allow-Headers&amp;#39;, &amp;#39;*&amp;#39;)&lt;/code&gt;
Much like the All-Methods reqsponse header, here you specify which request header fields to allow. If yr API is super wicked and secret then maybe you should put some controls on it.&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;The Pre-Flight Request&lt;/li&gt;
&lt;/ul&gt;
&lt;pre class="highlight plaintext"&gt;&lt;code&gt;if ( req.method === 'OPTIONS' ) {
  res.writeHead(200)
  res.end()
  return
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Sometimes, the CORS request needs to ask the API if it can CORS before it even attempts to CORS. That&amp;rsquo;s pretty weird stuff, but it&amp;rsquo;s also fairly typical as far as how the internets work. Just roll with it: if you get an OPTIONS request, 200 ok it immediately. The response will already contain all the CORS headers that you set, so that whatever is making the OPTIONS request knows what to do next.&lt;/p&gt;

&lt;hr&gt;

&lt;p&gt;There you have it! Now your users can access your API using javascript in the browser OR the server, and you can finally build a hexamorphic web application!&lt;/p&gt;

&lt;p&gt;You can see the cors in use in &lt;a href="https://github.com/coleww/corpora-api"&gt;this project&lt;/a&gt;, which basically serves up a directory of JSON files as an API. (but is also sadly not currently deployed anywhere)&lt;/p&gt;
</content>
  </entry>
  <entry>
    <title>Building a *nice* CLI For Your Sick npm Module</title>
    <link rel="alternate" href="http://colewillsea.com/blog/npm-cli.html"/>
    <id>http://colewillsea.com/blog/npm-cli.html</id>
    <published>2015-07-15T18:10:00-07:00</published>
    <updated>2015-07-25T08:40:30-07:00</updated>
    <author>
      <name>Article Author</name>
    </author>
    <content type="html">&lt;h1&gt;Building a &lt;em&gt;nice&lt;/em&gt; CLI For Your Sick npm Module&lt;/h1&gt;

&lt;h2&gt;A tale in backticks&lt;/h2&gt;

&lt;p&gt;Ok so you have written a pretty sweet node module. &lt;em&gt;nice&lt;/em&gt;. Ok so maybe you want to make this utility available on the command line?&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;&lt;code&gt;touch cmd.js&lt;/code&gt; =&amp;gt; lets make a file!&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;&lt;code&gt;chmod +x cmd.js&lt;/code&gt; =&amp;gt; lets make it executable!&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;&lt;code&gt;./cmd.js&lt;/code&gt; =&amp;gt; doesnt do anything yet!&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;But hey, it ran on the command line!&lt;/p&gt;

&lt;p&gt;THE END&lt;/p&gt;

&lt;p&gt;Ok so open up cmd.js in the text editor of yr choosing and add:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;&lt;code&gt;#!/usr/bin/env node&lt;/code&gt; =&amp;gt; This tells computer how to run this script&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;&lt;code&gt;var yrModule = require(&amp;#39;./&amp;#39;)&lt;/code&gt; =&amp;gt; Load up that code&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;But wait! What about arguments! I have a lot to say!&lt;/p&gt;

&lt;p&gt;shhhh go back to the command line:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;code&gt;npm install yargs --save&lt;/code&gt; =&amp;gt; &lt;a href="https://www.npmjs.com/package/yargs"&gt;yargs&lt;/a&gt; is pretty cool. &lt;a href="https://www.npmjs.com/package/minimist"&gt;minimist&lt;/a&gt; is also pretty cool. I ended up using yargs due to reasons that I cannot recall. Cool story.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Go back to the text editor and add:&lt;/p&gt;
&lt;pre class="highlight javascript"&gt;&lt;code&gt;&lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;argv&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;require&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'yargs'&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
  &lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;alias&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'h'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;'help'&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
  &lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;help&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'help'&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
  &lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;usage&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'what does thing do?'&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
  &lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;example&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'yrModule POTATOES!'&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
  &lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;alias&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'i'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;'intensity'&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
  &lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;describe&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'i'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;'describe what the arguments do'&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
  &lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;argv&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Of course&amp;hellip;you should probably edit things to suit yr module. You can chain multiple example/alias/describe calls if you want to show off more functionality or define other options.&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;code&gt;./cmd.js -h&lt;/code&gt; =&amp;gt; =&amp;gt; automatic documentation!&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Once defined, yargs literally does not care how things are passed to it.&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;&lt;code&gt;./cmd.js -i 72 what is up with airline food?&lt;/code&gt; =&amp;gt; ALL GOOD!&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;&lt;code&gt;./cmd.js what is up with airline food? --intensity=72&lt;/code&gt; =&amp;gt; TOTALLY COOL! SAME THING!&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;In either case, inside the running cmd.js script the following would be the truth:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;&lt;code&gt;argv._&lt;/code&gt; =&amp;gt; =&amp;gt; [&amp;lsquo;what&amp;rsquo;, &amp;#39;is&amp;rsquo;, &amp;#39;up&amp;rsquo;, &amp;#39;with&amp;rsquo;, &amp;#39;airline&amp;rsquo;, &amp;#39;food?&amp;rsquo;]&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;&lt;code&gt;argv.i&lt;/code&gt; =&amp;gt; =&amp;gt; 72&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;If your module is simple enough, you might be done! Back to the text editor!&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;&lt;code&gt;var output = yrModule(argv._.join(&amp;quot; &amp;quot;), argv.i)&lt;/code&gt; =&amp;gt; pass the arguments to yrModule (maybe it responds to jokes?)&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;&lt;code&gt;process.stdout.write(output)&lt;/code&gt; =&amp;gt; write the output to the terminal&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;&lt;code&gt;process.exit()&lt;/code&gt; =&amp;gt; exit the program&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;The UNIX ideology believes that building simple interfaces that accept text input and produce text output are super radical. We are fulfilling that dream right now. To the command line:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;code&gt;./cmd.js -i 12 awwwwoooooooooooooooooo | grep whales &amp;gt;&amp;gt; save_them.txt&lt;/code&gt; =&amp;gt; Amazing.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Well, I don&amp;rsquo;t know if yr module has anything to do with whales, but it probably should.&lt;/p&gt;

&lt;p&gt;But hey! &lt;code&gt;grep&lt;/code&gt; =&amp;gt; accepts that weird &lt;code&gt;|&lt;/code&gt; =&amp;gt; pipe thing! Can we accept the weird pipe thing and thus complete our embodiment of the UNIX philosophy?&lt;/p&gt;

&lt;p&gt;Yes. Sure. Lets edit some text.&lt;/p&gt;

&lt;p&gt;First we wrap our original non-pipey code with an if block:&lt;/p&gt;
&lt;pre class="highlight javascript"&gt;&lt;code&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;process&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;stdin&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;isTTY&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;output&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;yrModule&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;argv&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;_&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;join&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;" "&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="nx"&gt;argv&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;i&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
  &lt;span class="nx"&gt;process&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;stdout&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;write&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;output&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
  &lt;span class="nx"&gt;process&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;exit&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;

&lt;ul&gt;
&lt;li&gt;&lt;code&gt;process.stdin.isTTY&lt;/code&gt; =&amp;gt; basically asks node &amp;ldquo;IS THIS A TERMINAL?&amp;rdquo;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;And then the else case, for pipey-times:&lt;/p&gt;
&lt;pre class="highlight javascript"&gt;&lt;code&gt;&lt;span class="p"&gt;}&lt;/span&gt; &lt;span class="k"&gt;else&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;data&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;''&lt;/span&gt;
  &lt;span class="nx"&gt;process&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;stdin&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;resume&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
  &lt;span class="nx"&gt;process&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;stdin&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;setEncoding&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'utf8'&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
  &lt;span class="nx"&gt;process&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;stdin&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;on&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'data'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="kd"&gt;function&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;chunk&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="nx"&gt;data&lt;/span&gt; &lt;span class="o"&gt;+=&lt;/span&gt; &lt;span class="nx"&gt;chunk&lt;/span&gt;
  &lt;span class="p"&gt;})&lt;/span&gt;

  &lt;span class="nx"&gt;process&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;stdin&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;on&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'end'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="kd"&gt;function&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="nx"&gt;process&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;stdout&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;write&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;yrModule&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;data&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;argv&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;i&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
    &lt;span class="nx"&gt;process&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;exit&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
  &lt;span class="p"&gt;})&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;

&lt;ul&gt;
&lt;li&gt;&lt;code&gt;cat burrito_recipes.txt | ./cmd.js -i 400&lt;/code&gt; =&amp;gt; WOW all kinds of inputs&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;If your module is super complex and might be used on datasets that can&amp;rsquo;t be stored in RAM then you should probably stream the chunks directly into your codes rather than building up a data string and doing it all at once. But this is fine, it&amp;rsquo;s fine, probably fine. Totally.&lt;/p&gt;

&lt;p&gt;Cool! Now your module is ready to do all sorts of command line tricks. The last thing you need to remember to do before publishing this update to npm is adding a &amp;ldquo;bin&amp;rdquo; entry to your package.json file so that yr CLI script is available in the PATH of those who install your module. (But if you forget sometimes don&amp;rsquo;t worry about dat inevitable post-npm-publish-version-bump-re-publish it happens to the best of us.)&lt;/p&gt;
&lt;pre class="highlight javascript"&gt;&lt;code&gt;&lt;span class="s2"&gt;"bin"&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="s2"&gt;"yrModule"&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;"cmd.js"&lt;/span&gt;
&lt;span class="p"&gt;},&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Of course replace yrModule with whatever you want the command line executable to be. In this instance you could do:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;code&gt;yrModule foo fighters -i 65&lt;/code&gt; =&amp;gt; probably make sure you pick a name that isn&amp;rsquo;t already a thing, like &lt;code&gt;git&lt;/code&gt;, that would be bad. &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;ONE LAST THING!&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;code&gt;process.exit(1)&lt;/code&gt; =&amp;gt; handle yr errors! If yr CLI script fails for some reason, exit with a 1 so that computer knows that a bad thing happened.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;OK ONE OTHER THING!&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;code&gt;&amp;quot;preferGlobal&amp;quot;: true&lt;/code&gt; =&amp;gt; if your script is primarily a CLI tool and wouldn&amp;rsquo;t make much sense as a local project dependency, add this so users get a warning if they don&amp;rsquo;t &lt;code&gt;npm install -g&lt;/code&gt;. this would be for things like scaffolding tools or video games.&lt;/li&gt;
&lt;/ul&gt;

&lt;hr&gt;

&lt;ul&gt;
&lt;li&gt;&lt;code&gt;npm publish&lt;/code&gt; =&amp;gt; YOU ARE A HERO&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;You can see this sort of thing in action in this &lt;a href="https://github.com/coleww/diacriticize/blob/gh-pages/cmd.js"&gt;cmd.js example code from one of my modules&lt;/a&gt; as well as this &lt;a href="https://github.com/coleww/mkproj/blob/master/cmd.js"&gt;wow, absolute bare minimum here, doesn&amp;rsquo;t even take arguments, barely trying, cool&lt;/a&gt;&lt;/p&gt;
</content>
  </entry>
  <entry>
    <title>shelling out to the system</title>
    <link rel="alternate" href="http://colewillsea.com/blog/shelling-out.html"/>
    <id>http://colewillsea.com/blog/shelling-out.html</id>
    <published>2015-07-09T20:14:00-07:00</published>
    <updated>2015-07-10T08:50:25-07:00</updated>
    <author>
      <name>Article Author</name>
    </author>
    <content type="html">&lt;h1&gt;Shelling Out&lt;/h1&gt;

&lt;h2&gt;I would gladly shell out 5$ for you to pipe a burrito to me, streaming, over the course of the next 7 minutes.&lt;/h2&gt;

&lt;p&gt;Traditionally in UNIX land one would connect the output of various programs to the inputs of others with pipes (&lt;code&gt;|&lt;/code&gt;) directly on the command line, or within the depths of a shell script, like so:&lt;/p&gt;

&lt;p&gt;&lt;code&gt;cat recipe.txt | grep potatoes &amp;gt;&amp;gt; potato_ideas.txt&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;This is a great way to compose complex actions out of many small utilities.&lt;/p&gt;

&lt;p&gt;&lt;img alt="pipe" src="/blog/images/pipe.png" /&gt;&lt;/p&gt;

&lt;p&gt;Piping works fine for non-interactive programs that are all text-in/text-out, and you can certainly write bash scripts that &lt;code&gt;touch&lt;/code&gt; and &lt;code&gt;mkdir&lt;/code&gt; your way to many victories, but what about integrating more complicated CLI tools like npm, bower, ember, rails, or git? These programs do things like prompt the user to make decisions, hit the network, or generate a metric ton of files, and it might get unwieldy to try to control such chaos directly from the command line. Instead, you can write a script that shells out to them!&lt;/p&gt;

&lt;p&gt;&lt;img alt="shelling" src="/blog/images/shelling.png" /&gt;&lt;/p&gt;

&lt;p&gt;In Ruby, the easiest way to shell out a command is to put it backticks, like so:&lt;/p&gt;
&lt;pre class="highlight ruby"&gt;&lt;code&gt;&lt;span class="c1"&gt;# this would print the current directory&lt;/span&gt;
&lt;span class="nb"&gt;puts&lt;/span&gt; &lt;span class="sb"&gt;`ls`&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;The same shelling, but with Node.js:&lt;/p&gt;
&lt;pre class="highlight javascript"&gt;&lt;code&gt;&lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;exec&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;require&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'child_process'&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="nx"&gt;exec&lt;/span&gt;
&lt;span class="nx"&gt;exec&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'ls'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="kd"&gt;function&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;error&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;stdout&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;stderr&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="c1"&gt;// this would print the current directory&lt;/span&gt;
  &lt;span class="nx"&gt;console&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;log&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;stdout&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

  &lt;span class="c1"&gt;// probably some callback hell here&lt;/span&gt;
&lt;span class="p"&gt;});&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;With these, you can easily run shell commands and respond to their output as part of your script. But what if instead of just running a command you want to turn over control to a different program? Maybe that program has user prompts that need answering or it shows some pretty sweet terminal graphics.&lt;/p&gt;

&lt;p&gt;In Ruby you can use &lt;code&gt;exec&lt;/code&gt;, which replaces the current process with the given command:&lt;/p&gt;
&lt;pre class="highlight ruby"&gt;&lt;code&gt;&lt;span class="nb"&gt;exec&lt;/span&gt; &lt;span class="s2"&gt;"rails new monolith"&lt;/span&gt;
&lt;span class="nb"&gt;puts&lt;/span&gt; &lt;span class="s2"&gt;"never gets here cuz rails takes over"&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;In Node.js there is the &lt;a href="https://www.npmjs.com/package/kexec"&gt;kexec&lt;/a&gt; module, which does the exact same thing:&lt;/p&gt;
&lt;pre class="highlight javascript"&gt;&lt;code&gt;&lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;kexec&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;require&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'kexec'&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="nx"&gt;kexec&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'ember new behemoth'&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;I used some of these magical spells to build &lt;a href="https://github.com/coleww/mkproj"&gt;mkproj&lt;/a&gt;, which generates a bunch of files and does some NPM stuff in order to scaffold lil browserify projects. Being able to run code on the command line from a Ruby or Node script opens up tons of possibilities for destroying your computer in a for loop! Reader beware!&lt;/p&gt;
</content>
  </entry>
  <entry>
    <title>automating bots with cron on digital ocean</title>
    <link rel="alternate" href="http://colewillsea.com/blog/do-cron.html"/>
    <id>http://colewillsea.com/blog/do-cron.html</id>
    <published>2015-06-22T20:21:00-07:00</published>
    <updated>2015-06-24T22:39:37-07:00</updated>
    <author>
      <name>Article Author</name>
    </author>
    <content type="html">&lt;h1&gt;automating bots with cron on digital ocean&lt;/h1&gt;

&lt;h2&gt;because setInterval is probably not the right thing to do&lt;/h2&gt;

&lt;p&gt;I used to deploy all my bots to Heroku, running in constant loops on those sweet sweet free single dynos.&lt;/p&gt;

&lt;p&gt;They looked something like this:&lt;/p&gt;
&lt;pre class="highlight ruby"&gt;&lt;code&gt;    &lt;span class="kp"&gt;loop&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt;
        &lt;span class="c1"&gt;# do some stuff&lt;/span&gt;
        &lt;span class="no"&gt;BOT&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nf"&gt;post&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;funny_tweet_lol&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="nb"&gt;sleep&lt;/span&gt; &lt;span class="mi"&gt;10800&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;rand&lt;/span&gt; &lt;span class="mi"&gt;5400&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="k"&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;This is&amp;hellip;not optimal for a number of reasons. But since I could create new Heroku apps for free from the command line it was super easy, and, well, why not. I even made a &lt;a href="https://github.com/coleww/twitter_bot_generator"&gt;twitter bot generator ruby gem&lt;/a&gt; around the concept. Don&amp;rsquo;t judge me.&lt;/p&gt;

&lt;p&gt;With deng near fifty of these things running, I was not much pleased to hear about the new Heroku pricing plan. Though of course I couldn&amp;rsquo;t get mad cuz it was free servers in the first place. While I could have meticulously gone through all my Heroku apps and updated them to not loop/sleep forever and instead scheduled the scripts to run at various intervals, I figured it was finally time to get close to that cloud server metal and put together a lil droplet for myself in the Digital Ocean.&lt;/p&gt;

&lt;p&gt;There are many tutorials on setting up virtual servers, but I found that the biggest pain point in the process was getting my scripts to run on a schedule with cron.  It turns out that cron jobs are run with a very minimal environment setup, for reasons that I guess are cool. You can look up why but honestly it&amp;rsquo;s totally boring.&lt;/p&gt;

&lt;p&gt;&lt;img alt="corn" src="/blog/images/corn.jpg" /&gt;&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;WHY IS THERE NO NODE.JS HERE?!&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Even though I had installed all the nodes and rubies, my cron seemed to just ignore them. I thought that was quite rude. To fix this, you just need to export your path. Enter &lt;code&gt;echo PATH=$PATH&lt;/code&gt; and copy paste the output into your crontab.&lt;/p&gt;

&lt;p&gt;This was what I saw:&lt;/p&gt;
&lt;pre class="highlight plaintext"&gt;&lt;code&gt;root@1404-64:~# echo PATH=$PATH
PATH=/root/.nvm/versions/v0.12.2/bin:/usr/local/rvm/gems/ruby-2.2.1/bin:/usr/local/rvm/gems/ruby-2.2.1@global/bin:/usr/local/rvm/rubies/ruby-2.2.1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/usr/local/rvm/bin
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;And just dump it in the &lt;code&gt;crontab -e&lt;/code&gt; before your job listings.&lt;/p&gt;
&lt;pre class="highlight plaintext"&gt;&lt;code&gt;#
# For more information see the manual pages of crontab(5) and cron(8)
#
# m h  dom mon dow   command
PATH=/root/.nvm/versions/v0.12.2/bin:/usr/local/rvm/gems/ruby-2.2.1/bin:/usr/local/rvm/gems/ruby-2.2.1@global/bin:/usr/local/rvm/rubies/ruby-2.2.1/bin:/usr$
&lt;/code&gt;&lt;/pre&gt;

&lt;ul&gt;
&lt;li&gt;.././../././relative paths :&amp;lt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Now I had node, but my require(&amp;rsquo;./module&amp;rsquo;) calls didn&amp;rsquo;t seem to work! Cron apparently is not only PATHless but also pathless. My crons looked something like &lt;code&gt;* * * * * node bots/lolbot/bot.js &amp;gt;&amp;gt; ~/lol.log&lt;/code&gt; but in order to correctly set my working path, I just had to &lt;code&gt;cd&lt;/code&gt; into the parent directory before running the script, like so: &lt;code&gt;* * * * * cd bots/lolbot &amp;amp;&amp;amp; node bot.js &amp;gt;&amp;gt; ~/lol.log&lt;/code&gt;.&lt;/p&gt;

&lt;hr&gt;

&lt;p&gt;This &amp;ldquo;blog post&amp;rdquo; was &lt;a href="https://twitter.com/colewillsea/lists/my-robots"&gt;tested&lt;/a&gt; on a 512MB Ram20GB SSD Disk Ubuntu 14.04 x64 Digital Ocean droplet but will probably apply for pretty much any linux-y system anywhere.&lt;/p&gt;
</content>
  </entry>
  <entry>
    <title>Manually Trigger Loading Routes in Ember</title>
    <link rel="alternate" href="http://colewillsea.com/blog/trigger-loading-route-in-ember.html"/>
    <id>http://colewillsea.com/blog/trigger-loading-route-in-ember.html</id>
    <published>2015-06-09T10:12:00-07:00</published>
    <updated>2015-07-10T08:23:12-07:00</updated>
    <author>
      <name>Article Author</name>
    </author>
    <content type="html">&lt;h1&gt;Manually Trigger Loading Routes in Ember&lt;/h1&gt;

&lt;h2&gt;cuz Ember can&amp;rsquo;t do  e v e r y t h i n g  for you&lt;/h2&gt;

&lt;p&gt;Loading routes in Ember are pretty frigging sweet. You can drop a spinner .gif pretty much any frigging where you want. You can even make nested loading routes: it&amp;rsquo;s frigging awesome.&lt;/p&gt;

&lt;p&gt;One trick, however, is making use of those loading routes when persisting customer informatin to your datbase. The loading routes automagically hop into place while you are fetching data, but they can&amp;rsquo;t do the same when saving it. That would be weird and unfortunate.&lt;/p&gt;

&lt;p&gt;Instead, you must explicitly tell the router that you are loading some stuff and to just chill the frig out for a second while you figure some things out.&lt;/p&gt;

&lt;p&gt;FOR EXAMPLE (presuming you are on the user.edit route, editing yrself):&lt;/p&gt;
&lt;pre class="highlight javascript"&gt;&lt;code&gt;&lt;span class="nx"&gt;saveUserInformation&lt;/span&gt;&lt;span class="p"&gt;(){&lt;/span&gt;

  &lt;span class="c1"&gt;// MANUALLY TRANSITIONING TO THE LOADING ROUTE&lt;/span&gt;
  &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;transitionTo&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'loading'&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;

  &lt;span class="c1"&gt;// return a promise whose `then` and `catch` callbacks each transition to an appropriate route&lt;/span&gt;
  &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nx"&gt;user&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;save&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="nx"&gt;then&lt;/span&gt;&lt;span class="p"&gt;(()&lt;/span&gt;&lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;transitionTo&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'user.index'&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
    &lt;span class="c1"&gt;// success! go to the infernal User index and suffer with the rest of them!&lt;/span&gt;

  &lt;span class="p"&gt;}).&lt;/span&gt;&lt;span class="k"&gt;catch&lt;/span&gt;&lt;span class="p"&gt;((&lt;/span&gt;&lt;span class="nx"&gt;e&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="c1"&gt;// do something to User with the `e` errors --&amp;gt; very bad... show warning/&lt;/span&gt;

    &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;transitionTo&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'user.edit'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;user&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
    &lt;span class="c1"&gt;// return to the current page, with the current model data all still set like WOWWW&lt;/span&gt;
  &lt;span class="p"&gt;});&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;A N D   T H A T S    I T&lt;/p&gt;

&lt;p&gt;Just a simple &lt;code&gt;this.transitionTo(&amp;#39;loading&amp;#39;)&lt;/code&gt; and you can punt the Ember route back into loading mode. Try it today!&lt;/p&gt;
</content>
  </entry>
</feed>
